<!-- masterdata_roles_manager -->
<!DOCTYPE html>
<html lang="th">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• Roles | Rainbow OrcaKids</title>
    
    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@400;600&display=swap" rel="stylesheet">
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Supabase -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    
    <!-- SweetAlert2 ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Dialog ‡∏™‡∏ß‡∏¢‡∏á‡∏≤‡∏° -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    
</head>

<body class="font-sarabun bg-gray-50">
    <!-- Navigation ‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÇ‡∏î‡∏¢ nav.js -->
    
    <div class="container mx-auto px-4 py-8">


<!-- Header -->
<div class="flex flex-col md:flex-row md:items-center justify-between mb-8 gap-4">
    <div>
        <h1 class="text-3xl font-bold text-blue-700 mb-2">
            <i class="fas fa-user-shield mr-3"></i>‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• Roles
        </h1>
        <p class="text-gray-600">‡πÄ‡∏û‡∏¥‡πà‡∏°/‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç/‡∏•‡∏ö ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ö‡∏ó‡∏ö‡∏≤‡∏ó‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö</p>
    </div>
    
    <div class="flex gap-3">
        <!-- ‡∏õ‡∏∏‡πà‡∏°‡∏Å‡∏•‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤ Dashboard -->
        <a href="admin_dashboard.html" 
           class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-lg flex items-center transition duration-200">
            <i class="fas fa-tachometer-alt mr-2"></i>Dashboard
        </a>
        
        <!-- ‡∏õ‡∏∏‡πà‡∏°‡πÄ‡∏û‡∏¥‡πà‡∏° Role ‡πÉ‡∏´‡∏°‡πà -->
        <button onclick="showAddRoleModal()" 
                class="bg-green-500 hover:bg-green-600 text-white font-bold py-2 px-4 rounded-lg flex items-center transition duration-200">
            <i class="fas fa-plus mr-2"></i>‡πÄ‡∏û‡∏¥‡πà‡∏° Role ‡πÉ‡∏´‡∏°‡πà
        </button>
    </div>
</div>



        <!-- Stats Cards -->
        <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-8">
            <div class="bg-white p-4 rounded-lg shadow border border-blue-100">
                <div class="flex items-center">
                    <div class="p-3 rounded-full bg-blue-100 text-blue-600 mr-4">
                        <i class="fas fa-users text-xl"></i>
                    </div>
                    <div>
                        <p class="text-gray-500 text-sm">‡∏£‡∏ß‡∏° Roles</p>
                        <p id="totalRoles" class="text-2xl font-bold">0</p>
                    </div>
                </div>
            </div>
            <div class="bg-white p-4 rounded-lg shadow border border-green-100">
                <div class="flex items-center">
                    <div class="p-3 rounded-full bg-green-100 text-green-600 mr-4">
                        <i class="fas fa-check-circle text-xl"></i>
                    </div>
                    <div>
                        <p class="text-gray-500 text-sm">‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏≠‡∏¢‡∏π‡πà</p>
                        <p id="activeRoles" class="text-2xl font-bold">0</p>
                    </div>
                </div>
            </div>
            <div class="bg-white p-4 rounded-lg shadow border border-yellow-100">
                <div class="flex items-center">
                    <div class="p-3 rounded-full bg-yellow-100 text-yellow-600 mr-4">
                        <i class="fas fa-pause-circle text-xl"></i>
                    </div>
                    <div>
                        <p class="text-gray-500 text-sm">‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô</p>
                        <p id="inactiveRoles" class="text-2xl font-bold">0</p>
                    </div>
                </div>
            </div>
            <div class="bg-white p-4 rounded-lg shadow border border-purple-100">
                <div class="flex items-center">
                    <div class="p-3 rounded-full bg-purple-100 text-purple-600 mr-4">
                        <i class="fas fa-list-ol text-xl"></i>
                    </div>
                    <div>
                        <p class="text-gray-500 text-sm">‡∏•‡∏≥‡∏î‡∏±‡∏ö‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î</p>
                        <p id="maxOrder" class="text-2xl font-bold">0</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Search and Filter -->
        <div class="bg-white p-4 rounded-lg shadow mb-6">
            <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-4">
                <div class="flex-1">
                    <div class="relative">
                        <input type="text" id="searchInput" 
                               placeholder="‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏ï‡∏≤‡∏°‡∏ä‡∏∑‡πà‡∏≠ Role, ‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢..."
                               class="w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                        <i class="fas fa-search absolute left-3 top-3 text-gray-400"></i>
                    </div>
                </div>
                <div class="flex items-center space-x-4">
                    <select id="statusFilter" 
                            class="border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500">
                        <option value="all">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</option>
                        <option value="active">‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏≠‡∏¢‡∏π‡πà</option>
                        <option value="inactive">‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô</option>
                    </select>
                    <button onclick="loadRoles()" 
                            class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded-lg flex items-center">
                        <i class="fas fa-sync-alt mr-2"></i>‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä
                    </button>
                </div>
            </div>
        </div>

        <!-- Loading -->
        <div id="loadingStatus" class="p-4 bg-yellow-50 rounded-lg border border-yellow-200 text-gray-700 mb-6">
            <i class="fas fa-spinner fa-spin mr-2"></i>‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• Roles...
        </div>

        <!-- Roles Table -->
        <div class="bg-white rounded-lg shadow overflow-hidden mb-8">
            <div class="overflow-x-auto">
                <table class="min-w-full divide-y divide-gray-200">
                    <thead class="bg-gray-50">
                        <tr>
                            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                <i class="fas fa-sort mr-1"></i>‡∏•‡∏≥‡∏î‡∏±‡∏ö
                            </th>
                            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                <i class="fas fa-key mr-1"></i>Role Key
                            </th>
                            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                <i class="fas fa-user-tag mr-1"></i>‡∏ä‡∏∑‡πà‡∏≠‡∏ö‡∏ó‡∏ö‡∏≤‡∏ó
                            </th>
                            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                <i class="fas fa-list mr-1"></i>Permissions
                            </th>
                            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                <i class="fas fa-toggle-on mr-1"></i>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞
                            </th>
                            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                <i class="fas fa-calendar mr-1"></i>‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÄ‡∏°‡∏∑‡πà‡∏≠
                            </th>
                            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                <i class="fas fa-cogs mr-1"></i>‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£
                            </th>
                        </tr>
                    </thead>
                    <tbody id="rolesTableBody" class="bg-white divide-y divide-gray-200">
                        <!-- Data will be inserted here -->
                    </tbody>
                </table>
            </div>
        </div>

        <!-- No Data Message (hidden by default) -->
        <div id="noDataMessage" class="hidden text-center py-12">
            <i class="fas fa-inbox text-gray-300 text-5xl mb-4"></i>
            <h3 class="text-xl font-semibold text-gray-500 mb-2">‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• Roles</h3>
            <p class="text-gray-400 mb-6">‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏î‡πâ‡∏ß‡∏¢‡∏Å‡∏≤‡∏£‡πÄ‡∏û‡∏¥‡πà‡∏° Role ‡πÉ‡∏´‡∏°‡πà</p>
            <button onclick="showAddRoleModal()" 
                    class="bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-6 rounded-lg">
                <i class="fas fa-plus mr-2"></i>‡πÄ‡∏û‡∏¥‡πà‡∏° Role ‡πÉ‡∏´‡∏°‡πà
            </button>
        </div>

        <!-- Back Button -->
        <div class="text-center">
            <a href="index.html" class="inline-flex items-center text-blue-600 hover:text-blue-800 font-semibold">
                <i class="fas fa-arrow-left mr-2"></i>‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å
            </a>
        </div>
    </div>

    <!-- Add/Edit Role Modal (hidden by default) -->
    <div id="roleModal" class="fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full hidden z-50">
        <div class="relative top-20 mx-auto p-5 border w-full max-w-2xl shadow-lg rounded-md bg-white">
            <div class="flex justify-between items-center pb-3 border-b">
                <h3 id="modalTitle" class="text-2xl font-bold text-gray-700"></h3>
                <button onclick="closeRoleModal()" class="text-gray-400 hover:text-gray-600">
                    <i class="fas fa-times text-2xl"></i>
                </button>
            </div>
            
            <div class="mt-6">
                <form id="roleForm" onsubmit="saveRole(event)">
                    <input type="hidden" id="roleId">
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <!-- Role Key -->
                        <div>
                            <label class="block text-gray-700 text-sm font-bold mb-2">
                                <i class="fas fa-key mr-1"></i>Role Key *
                            </label>
                            <input type="text" id="roleKey" 
                                   class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                                   placeholder="‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á: admin, teacher, student"
                                   required>
                            <p class="text-xs text-gray-500 mt-1">‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏õ‡πá‡∏ô‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô ‡πÉ‡∏ä‡πâ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏≠‡πâ‡∏≤‡∏á‡∏≠‡∏¥‡∏á‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö</p>
                        </div>

                        <!-- Display Order -->
                        <div>
                            <label class="block text-gray-700 text-sm font-bold mb-2">
                                <i class="fas fa-sort-numeric-up mr-1"></i>‡∏•‡∏≥‡∏î‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏• *
                            </label>
                            <input type="number" id="displayOrder" min="0" max="999"
                                   class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                                   required>
                        </div>

                        <!-- Thai Name -->
                        <div>
                            <label class="block text-gray-700 text-sm font-bold mb-2">
                                <i class="fas fa-font mr-1"></i>‡∏ä‡∏∑‡πà‡∏≠‡∏ö‡∏ó‡∏ö‡∏≤‡∏ó (‡πÑ‡∏ó‡∏¢) *
                            </label>
                            <input type="text" id="roleNameTh" 
                                   class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                                   placeholder="‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á: ‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•‡∏£‡∏∞‡∏ö‡∏ö"
                                   required>
                        </div>

                        <!-- English Name -->
                        <div>
                            <label class="block text-gray-700 text-sm font-bold mb-2">
                                <i class="fas fa-font mr-1"></i>‡∏ä‡∏∑‡πà‡∏≠‡∏ö‡∏ó‡∏ö‡∏≤‡∏ó (‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©)
                            </label>
                            <input type="text" id="roleNameEn" 
                                   class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                                   placeholder="‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á: Administrator">
                        </div>

                        <!-- Description -->
                        <div class="md:col-span-2">
                            <label class="block text-gray-700 text-sm font-bold mb-2">
                                <i class="fas fa-align-left mr-1"></i>‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢
                            </label>
                            <textarea id="description" rows="3"
                                      class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                                      placeholder="‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢‡∏ö‡∏ó‡∏ö‡∏≤‡∏ó‡∏ô‡∏µ‡πâ..."></textarea>
                        </div>

                        <!-- Permissions (Simplified JSON) -->
                        <div class="md:col-span-2">
                            <label class="block text-gray-700 text-sm font-bold mb-2">
                                <i class="fas fa-list-check mr-1"></i>Permissions (JSON Format)
                            </label>
                            <textarea id="permissions" rows="4"
                                      class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 font-mono text-sm"
                                      placeholder='{"view": true, "create": true, "edit": true, "delete": false}'></textarea>
                            <p class="text-xs text-gray-500 mt-1">‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö JSON ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á</p>
                        </div>

                        <!-- Status -->
                        <div>
                            <label class="block text-gray-700 text-sm font-bold mb-2">
                                <i class="fas fa-toggle-on mr-1"></i>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞
                            </label>
                            <div class="flex items-center space-x-4 mt-2">
                                <label class="flex items-center">
                                    <input type="radio" name="isActive" value="true" checked
                                           class="mr-2 text-blue-600 focus:ring-blue-500">
                                    <span class="text-green-600">
                                        <i class="fas fa-check-circle mr-1"></i>‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏≠‡∏¢‡∏π‡πà
                                    </span>
                                </label>
                                <label class="flex items-center">
                                    <input type="radio" name="isActive" value="false"
                                           class="mr-2 text-blue-600 focus:ring-blue-500">
                                    <span class="text-red-600">
                                        <i class="fas fa-times-circle mr-1"></i>‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô
                                    </span>
                                </label>
                            </div>
                        </div>
                    </div>

                    <!-- Form Actions -->
                    <div class="flex justify-end space-x-3 mt-8 pt-4 border-t">
                        <button type="button" onclick="closeRoleModal()"
                                class="px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50">
                            ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å
                        </button>
                        <button type="submit" id="submitButton"
                                class="px-6 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 flex items-center">
                            <i class="fas fa-save mr-2"></i>‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="js/supabase-config.js"></script>
    <script src="js/auth_status_manager.js"></script>
    <script src="js/nav.js"></script>
    
    <!-- Debug Logger -->
    <script src="js/debug-logger.js"></script>
    
    <script>
document.addEventListener('DOMContentLoaded', async () => {
    console.log("üîê Checking admin permission for this page...");
    
    // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå admin ‡πÉ‡∏ä‡πâ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÅ‡∏ö‡∏ö‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ô‡∏Å‡∏±‡∏ö admin_dashboard.html
    const hasPermission = await checkAdminPermission();
    
    if (!hasPermission) {
        // Redirect ‡πÑ‡∏õ‡∏´‡∏ô‡πâ‡∏≤ dashboard ‡πÅ‡∏ó‡∏ô index.html
        Swal.fire({
            icon: 'warning',
            title: '‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á',
            text: '‡∏´‡∏ô‡πâ‡∏≤‡∏ô‡∏µ‡πâ‡∏à‡∏≥‡∏Å‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô',
            confirmButtonText: '‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡∏´‡∏ô‡πâ‡∏≤ Dashboard',
            allowOutsideClick: false,
            allowEscapeKey: false
        }).then((result) => {
            if (result.isConfirmed) {
                window.location.href = 'admin_dashboard.html';
            }
        });
        return;
    }
    
    // ‡∏ñ‡πâ‡∏≤‡∏°‡∏µ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå ‡πÉ‡∏´‡πâ‡πÇ‡∏´‡∏•‡∏î‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤‡∏´‡∏•‡∏±‡∏Å
    loadPageContent();
});

// ===============================================
// ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö admin permission (‡πÉ‡∏ä‡πâ fetchUserProfile)
// ===============================================
async function checkAdminPermission() {
    try {
        console.log("üîç Checking admin permission...");
        
        const supabase = await getSupabaseClient();
        if (!supabase) {
            console.error("‚ùå Supabase client not available");
            return false;
        }
        
        // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö session
        const { data: { session }, error: sessionError } = await supabase.auth.getSession();
        if (sessionError) {
            console.error("‚ùå Session error:", sessionError);
            return false;
        }
        
        if (!session || !session.user) {
            console.warn("‚ö†Ô∏è No user session found");
            return false;
        }
        
        console.log("üë§ User logged in:", session.user.email);
        
        // ‡πÉ‡∏ä‡πâ fetchUserProfile ‡∏à‡∏≤‡∏Å auth_status_manager.js ‡πÇ‡∏î‡∏¢‡∏ï‡∏£‡∏á
        if (typeof window.fetchUserProfile !== 'function') {
            console.error("‚ùå fetchUserProfile function not available");
            return false;
        }
        
        const profile = await window.fetchUserProfile(session.user);
        console.log("üìä User profile:", profile);
        
        if (!profile) {
            console.error("‚ùå Cannot fetch user profile");
            return false;
        }
        
        // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤ role ‡πÄ‡∏õ‡πá‡∏ô admin ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
        const isAdmin = profile.role === 'admin' || 
                       profile.role === 'administrator' || 
                       profile.role === 'superadmin';
        
        if (isAdmin) {
            console.log("‚úÖ Admin permission granted");
        } else {
            console.warn("‚ö†Ô∏è User is not an admin, role:", profile.role);
        }
        
        return isAdmin;
        
    } catch (error) {
        console.error("‚ùå Error in checkAdminPermission:", error);
        return false;
    }
}



// ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÇ‡∏´‡∏•‡∏î‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤‡∏´‡∏•‡∏±‡∏Å
async function loadPageContent() {
    console.log("‚úÖ Admin permission verified, loading page content...");
    
    // ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ Event Listeners
    document.getElementById('searchInput').addEventListener('keyup', filterRoles);
    document.getElementById('statusFilter').addEventListener('change', filterRoles);
    
    // ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• Roles
    await loadRoles();
    
    // Initialize Debug Logger
    initDebugLogger();
}
</script>
    
    
    <!-- Roles Manager JavaScript -->
<script>
    let currentRoles = [];
    let isEditMode = false;
    
    // ===============================================
    // Debug Logger Wrapper Functions
    // ‡πÉ‡∏ä‡πâ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô error ‡πÄ‡∏°‡∏∑‡πà‡∏≠ DebugLogger ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏û‡∏£‡πâ‡∏≠‡∏°
    // ===============================================
    
    function logSuccess(message) {
        if (window.DebugLogger && typeof window.DebugLogger.success === 'function') {
            window.DebugLogger.success(message);
        } else {
            console.log('‚úÖ ' + message);
        }
    }
    
    function logError(message) {
        if (window.DebugLogger && typeof window.DebugLogger.error === 'function') {
            window.DebugLogger.error(message);
        } else {
            console.error('‚ùå ' + message);
        }
    }
    
    function logInfo(message) {
        if (window.DebugLogger && typeof window.DebugLogger.info === 'function') {
            window.DebugLogger.info(message);
        } else {
            console.info('‚ÑπÔ∏è ' + message);
        }
    }
    
    function logWarning(message) {
        if (window.DebugLogger && typeof window.DebugLogger.warning === 'function') {
            window.DebugLogger.warning(message);
        } else {
            console.warn('‚ö†Ô∏è ' + message);
        }
    }
    
    // ===============================================
    // Fallback Debug Logger ‡∏´‡∏≤‡∏Å‡πÑ‡∏ü‡∏•‡πå‡πÑ‡∏°‡πà‡πÇ‡∏´‡∏•‡∏î
    // ===============================================
    
    if (!window.DebugLogger) {
        console.log('‚ö†Ô∏è DebugLogger not found, using fallback logger');
        window.DebugLogger = {
            init: function() { console.log('Fallback DebugLogger initialized'); },
            log: function(msg, type) { 
                const icon = type === 'success' ? '‚úÖ' : 
                            type === 'error' ? '‚ùå' : 
                            type === 'warning' ? '‚ö†Ô∏è' : 
                            type === 'info' ? 'üîµ' : 'üìù';
                console.log(`${icon} ${msg}`);
            },
            success: function(msg) { console.log('‚úÖ ' + msg); },
            error: function(msg) { console.error('‚ùå ' + msg); },
            warning: function(msg) { console.warn('‚ö†Ô∏è ' + msg); },
            info: function(msg) { console.info('‚ÑπÔ∏è ' + msg); },
            debug: function(msg) { console.debug('üêõ ' + msg); }
        };
    }
    
    // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÅ‡∏•‡∏∞ init DebugLogger
    function initDebugLogger() {
        if (window.DebugLogger && typeof window.DebugLogger.init === 'function') {
            try {
                window.DebugLogger.init();
                console.log('‚úÖ DebugLogger initialized');
            } catch (e) {
                console.warn('‚ö†Ô∏è DebugLogger init failed:', e);
            }
        }
    }

    document.addEventListener('DOMContentLoaded', async () => {
        console.log("üìÑ Roles Manager page loaded");
        
        // Initialize Debug Logger
        initDebugLogger();
        
        // ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ Event Listeners
        document.getElementById('searchInput').addEventListener('keyup', filterRoles);
        document.getElementById('statusFilter').addEventListener('change', filterRoles);
        
        // ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• Roles
        await loadRoles();
    });

    // ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• Roles ‡∏à‡∏≤‡∏Å Supabase
    async function loadRoles() {
        const loadingStatus = document.getElementById('loadingStatus');
        const noDataMessage = document.getElementById('noDataMessage');
        const tableBody = document.getElementById('rolesTableBody');
        
        loadingStatus.classList.remove('hidden');
        tableBody.innerHTML = '';
        
        try {
            const supabase = await getSupabaseClient();
            if (!supabase) {
                showError('‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏Å‡∏±‡∏ö‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏î‡πâ');
                return;
            }
            
            // ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• roles ‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏•‡∏≥‡∏î‡∏±‡∏ö‡∏ï‡∏≤‡∏° display_order
            const { data: roles, error } = await supabase
                .from('roles')
                .select('*')
                .order('display_order', { ascending: true });
            
            if (error) throw error;
            
            currentRoles = roles || [];
            
            // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥
            updateStats(currentRoles);
            
            // ‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô‡∏ï‡∏≤‡∏£‡∏≤‡∏á
            if (currentRoles.length > 0) {
                renderRolesTable(currentRoles);
                noDataMessage.classList.add('hidden');
            } else {
                tableBody.innerHTML = '';
                noDataMessage.classList.remove('hidden');
            }
            
            loadingStatus.classList.add('hidden');
            
            // ‡πÉ‡∏ä‡πâ wrapper function ‡πÅ‡∏ó‡∏ô
            logSuccess(`‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• Roles ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à: ${currentRoles.length} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£`);
            
        } catch (error) {
            loadingStatus.classList.add('hidden');
            showError('‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• Roles ‡πÑ‡∏î‡πâ: ' + error.message);
            // ‡πÉ‡∏ä‡πâ wrapper function ‡πÅ‡∏ó‡∏ô
            logError('Error loading roles: ' + error.message);
        }
    }

    // ‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô‡∏ï‡∏≤‡∏£‡∏≤‡∏á
    function renderRolesTable(roles) {
        const tableBody = document.getElementById('rolesTableBody');
        tableBody.innerHTML = '';
        
        roles.forEach((role, index) => {
            const row = document.createElement('tr');
            row.className = 'hover:bg-gray-50 transition-colors';
            
            // ‡∏ü‡∏≠‡∏£‡πå‡πÅ‡∏°‡∏ï‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà
            const createdDate = new Date(role.created_at).toLocaleDateString('th-TH', {
                year: 'numeric',
                month: 'short',
                day: 'numeric'
            });
            
            // ‡∏ü‡∏≠‡∏£‡πå‡πÅ‡∏°‡∏ï permissions
            let permissionsText = '-';
            if (role.permissions && typeof role.permissions === 'object') {
                const permKeys = Object.keys(role.permissions);
                permissionsText = permKeys.length > 0 ? permKeys.join(', ') : '-';
            }
            
            row.innerHTML = `
                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900 font-medium">
                    ${role.display_order}
                </td>
                <td class="px-6 py-4 whitespace-nowrap">
                    <span class="px-2 py-1 text-xs font-semibold rounded-full bg-blue-100 text-blue-800">
                        ${role.role_key}
                    </span>
                </td>
                <td class="px-6 py-4">
                    <div class="text-sm font-medium text-gray-900">${role.role_name_th}</div>
                    <div class="text-sm text-gray-500">${role.role_name_en || '-'}</div>
                </td>
                <td class="px-6 py-4 text-sm text-gray-900 max-w-xs truncate" title="${permissionsText}">
                    ${permissionsText}
                </td>
                <td class="px-6 py-4 whitespace-nowrap">
                    <span class="px-2 py-1 text-xs font-semibold rounded-full ${role.is_active ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'}">
                        ${role.is_active ? '‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô' : '‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô'}
                    </span>
                </td>
                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                    <i class="far fa-clock mr-1"></i>${createdDate}
                </td>
                <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                    <button onclick="editRole('${role.role_id}')" 
                            class="text-blue-600 hover:text-blue-900 mr-3" title="‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç">
                        <i class="fas fa-edit"></i>
                    </button>
                    <button onclick="deleteRole('${role.role_id}', '${role.role_name_th}')" 
                            class="text-red-600 hover:text-red-900" title="‡∏•‡∏ö">
                        <i class="fas fa-trash"></i>
                    </button>
                </td>
            `;
            
            tableBody.appendChild(row);
        });
    }

    // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥
    function updateStats(roles) {
        const total = roles.length;
        const active = roles.filter(r => r.is_active).length;
        const inactive = total - active;
        const maxOrder = roles.length > 0 ? Math.max(...roles.map(r => r.display_order)) : 0;
        
        document.getElementById('totalRoles').textContent = total;
        document.getElementById('activeRoles').textContent = active;
        document.getElementById('inactiveRoles').textContent = inactive;
        document.getElementById('maxOrder').textContent = maxOrder;
    }

    // ‡∏Å‡∏£‡∏≠‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• Roles
    function filterRoles() {
        const searchTerm = document.getElementById('searchInput').value.toLowerCase();
        const statusFilter = document.getElementById('statusFilter').value;
        
        let filtered = currentRoles;
        
        // ‡∏Å‡∏£‡∏≠‡∏á‡∏ï‡∏≤‡∏°‡∏Ñ‡∏≥‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤
        if (searchTerm) {
            filtered = filtered.filter(role => 
                role.role_key.toLowerCase().includes(searchTerm) ||
                role.role_name_th.toLowerCase().includes(searchTerm) ||
                role.role_name_en?.toLowerCase().includes(searchTerm) ||
                role.description?.toLowerCase().includes(searchTerm)
            );
        }
        
        // ‡∏Å‡∏£‡∏≠‡∏á‡∏ï‡∏≤‡∏°‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞
        if (statusFilter !== 'all') {
            filtered = filtered.filter(role => 
                statusFilter === 'active' ? role.is_active : !role.is_active
            );
        }
        
        renderRolesTable(filtered);
    }

    // ‡πÅ‡∏™‡∏î‡∏á Modal ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÄ‡∏û‡∏¥‡πà‡∏° Role
    function showAddRoleModal() {
        isEditMode = false;
        document.getElementById('modalTitle').textContent = '‡πÄ‡∏û‡∏¥‡πà‡∏° Role ‡πÉ‡∏´‡∏°‡πà';
        document.getElementById('submitButton').innerHTML = '<i class="fas fa-save mr-2"></i>‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•';
        
        // ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏ü‡∏≠‡∏£‡πå‡∏°
        document.getElementById('roleForm').reset();
        document.getElementById('roleId').value = '';
        
        // ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ display order ‡∏ñ‡∏±‡∏î‡πÑ‡∏õ
        const maxOrder = Math.max(...currentRoles.map(r => r.display_order), 0);
        document.getElementById('displayOrder').value = maxOrder + 1;
        
        // ‡πÅ‡∏™‡∏î‡∏á Modal
        document.getElementById('roleModal').classList.remove('hidden');
    }

    // ‡πÅ‡∏™‡∏î‡∏á Modal ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç Role
    async function editRole(roleId) {
        const role = currentRoles.find(r => r.role_id === roleId);
        if (!role) {
            showError('‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• Role ‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç');
            return;
        }
        
        isEditMode = true;
        document.getElementById('modalTitle').textContent = '‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç Role';
        document.getElementById('submitButton').innerHTML = '<i class="fas fa-save mr-2"></i>‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•';
        
        // ‡πÄ‡∏ï‡∏¥‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡∏á‡πÉ‡∏ô‡∏ü‡∏≠‡∏£‡πå‡∏°
        document.getElementById('roleId').value = role.role_id;
        document.getElementById('roleKey').value = role.role_key;
        document.getElementById('roleKey').readOnly = true; // ‡πÑ‡∏°‡πà‡πÉ‡∏´‡πâ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç key
        document.getElementById('displayOrder').value = role.display_order;
        document.getElementById('roleNameTh').value = role.role_name_th;
        document.getElementById('roleNameEn').value = role.role_name_en || '';
        document.getElementById('description').value = role.description || '';
        
        // ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ permissions
        if (role.permissions && typeof role.permissions === 'object') {
            document.getElementById('permissions').value = JSON.stringify(role.permissions, null, 2);
        } else {
            document.getElementById('permissions').value = '';
        }
        
        // ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞
        const activeRadio = document.querySelector(`input[name="isActive"][value="${role.is_active}"]`);
        if (activeRadio) {
            activeRadio.checked = true;
        }
        
        // ‡πÅ‡∏™‡∏î‡∏á Modal
        document.getElementById('roleModal').classList.remove('hidden');
    }

    // ‡∏õ‡∏¥‡∏î Modal
    function closeRoleModal() {
        document.getElementById('roleModal').classList.add('hidden');
        document.getElementById('roleKey').readOnly = false; // ‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏´‡πâ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç key ‡πÉ‡∏´‡∏°‡πà
    }

    // ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• Role
    async function saveRole(event) {
        event.preventDefault();
        
        try {
            const supabase = await getSupabaseClient();
            if (!supabase) {
                showError('‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏Å‡∏±‡∏ö‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏î‡πâ');
                return;
            }
            
            const roleData = {
                role_key: document.getElementById('roleKey').value.trim(),
                display_order: parseInt(document.getElementById('displayOrder').value),
                role_name_th: document.getElementById('roleNameTh').value.trim(),
                role_name_en: document.getElementById('roleNameEn').value.trim() || null,
                description: document.getElementById('description').value.trim() || null,
                is_active: document.querySelector('input[name="isActive"]:checked').value === 'true'
            };
            
            // Parse permissions JSON
            const permissionsText = document.getElementById('permissions').value.trim();
            if (permissionsText) {
                try {
                    roleData.permissions = JSON.parse(permissionsText);
                } catch (e) {
                    showError('‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö JSON ‡∏Ç‡∏≠‡∏á Permissions ‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á');
                    return;
                }
            } else {
                roleData.permissions = {};
            }
            
            const roleId = document.getElementById('roleId').value;
            
            let result;
            if (isEditMode && roleId) {
                // ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
                const { data, error } = await supabase
                    .from('roles')
                    .update({
                        ...roleData,
                        updated_at: new Date().toISOString()
                    })
                    .eq('role_id', roleId)
                    .select();
                
                if (error) throw error;
                result = data[0];
                
                // ‡πÉ‡∏ä‡πâ wrapper function ‡πÅ‡∏ó‡∏ô
                logSuccess(`‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï Role ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à: ${roleData.role_name_th}`);
                
            } else {
                // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡∏°‡πà
                const { data, error } = await supabase
                    .from('roles')
                    .insert([roleData])
                    .select();
                
                if (error) throw error;
                result = data[0];
                
                // ‡πÉ‡∏ä‡πâ wrapper function ‡πÅ‡∏ó‡∏ô
                logSuccess(`‡πÄ‡∏û‡∏¥‡πà‡∏° Role ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à: ${roleData.role_name_th}`);
            }
            
            // ‡∏õ‡∏¥‡∏î Modal ‡πÅ‡∏•‡∏∞‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
            closeRoleModal();
            await loadRoles();
            
            // ‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à
            Swal.fire({
                icon: 'success',
                title: '‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!',
                text: `‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• Role "${roleData.role_name_th}" ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à`,
                timer: 2000,
                showConfirmButton: false
            });
            
        } catch (error) {
            console.error('Error saving role:', error);
            
            if (error.code === '23505') { // Unique violation
                showError('Role Key ‡∏ô‡∏µ‡πâ‡∏°‡∏µ‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö‡πÅ‡∏•‡πâ‡∏ß ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏ä‡πâ Key ‡∏≠‡∏∑‡πà‡∏ô');
            } else {
                showError('‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à: ' + error.message);
            }
            
            // ‡πÉ‡∏ä‡πâ wrapper function ‡πÅ‡∏ó‡∏ô
            logError('Error saving role: ' + error.message);
        }
    }

    // ‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• Role
    async function deleteRole(roleId, roleName) {
        // ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡∏ö
        const result = await Swal.fire({
            title: '‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡∏ö',
            text: `‡∏Ñ‡∏∏‡∏ì‡πÅ‡∏ô‡πà‡πÉ‡∏à‡∏ß‡πà‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö Role "${roleName}" ‡πÉ‡∏ä‡πà‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?`,
            icon: 'warning',
            showCancelButton: true,
            confirmButtonColor: '#d33',
            cancelButtonColor: '#3085d6',
            confirmButtonText: '‡πÉ‡∏ä‡πà, ‡∏•‡∏ö‡πÄ‡∏•‡∏¢!',
            cancelButtonText: '‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å'
        });
        
        if (!result.isConfirmed) return;
        
        try {
            const supabase = await getSupabaseClient();
            if (!supabase) {
                showError('‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏Å‡∏±‡∏ö‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏î‡πâ');
                return;
            }
            
            const { error } = await supabase
                .from('roles')
                .delete()
                .eq('role_id', roleId);
            
            if (error) throw error;
            
            // ‡πÉ‡∏ä‡πâ wrapper function ‡πÅ‡∏ó‡∏ô
            logSuccess(`‡∏•‡∏ö Role ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à: ${roleName}`);
            
            // ‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
            await loadRoles();
            
            // ‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à
            Swal.fire({
                icon: 'success',
                title: '‡∏•‡∏ö‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!',
                text: `‡∏•‡∏ö Role "${roleName}" ‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö‡πÅ‡∏•‡πâ‡∏ß`,
                timer: 2000,
                showConfirmButton: false
            });
            
        } catch (error) {
            console.error('Error deleting role:', error);
            
            // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤ Role ‡∏ô‡∏µ‡πâ‡∏ñ‡∏π‡∏Å‡πÉ‡∏ä‡πâ‡∏≠‡∏¢‡∏π‡πà‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
            if (error.code === '23503') { // Foreign key violation
                showError('‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏•‡∏ö Role ‡∏ô‡∏µ‡πâ‡πÑ‡∏î‡πâ ‡πÄ‡∏ô‡∏∑‡πà‡∏≠‡∏á‡∏à‡∏≤‡∏Å‡∏ñ‡∏π‡∏Å‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö‡πÅ‡∏•‡πâ‡∏ß');
            } else {
                showError('‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à: ' + error.message);
            }
            
            // ‡πÉ‡∏ä‡πâ wrapper function ‡πÅ‡∏ó‡∏ô
            logError('Error deleting role: ' + error.message);
        }
    }

    // ‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô
    function showError(message) {
        Swal.fire({
            icon: 'error',
            title: '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î',
            text: message,
            confirmButtonText: '‡∏ï‡∏Å‡∏•‡∏á'
        });
    }
</script>
 
    <style>
        /* Custom styles */
        .hover-scale {
            transition: transform 0.2s ease-in-out;
        }
        .hover-scale:hover {
            transform: translateY(-2px);
        }
        
        input:focus, textarea:focus, select:focus {
            outline: none;
            ring: 2px;
        }
        
        /* Scrollbar styling */
        #rolesTableBody::-webkit-scrollbar {
            width: 6px;
        }
        
        #rolesTableBody::-webkit-scrollbar-track {
            background: #f1f1f1;
        }
        
        #rolesTableBody::-webkit-scrollbar-thumb {
            background: #888;
            border-radius: 3px;
        }
        
        #rolesTableBody::-webkit-scrollbar-thumb:hover {
            background: #555;
        }
    </style>
</body>
</html>