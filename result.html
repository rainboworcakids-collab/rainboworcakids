<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Psychomatrix Analysis Result - Universal Path Version</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        body { font-family: 'Sarabun', sans-serif; }
        .tab-container { background: white; border-radius: 0.75rem; overflow: hidden; box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1); }
        .tab-buttons { display: flex; background: #f3f4f6; border-bottom: 2px solid #e5e7eb; }
        .tab-button { flex: 1; padding: 1rem; font-weight: bold; cursor: pointer; transition: all 0.2s; color: #6b7280; border: none; }
        .tab-button.active { background: white; color: #667eea; border-bottom: 3px solid #667eea; }
        .tab-pane { display: none; padding: 1.5rem; min-height: 500px; }
        .tab-pane.active { display: block; animation: fadeIn 0.3s ease-in-out; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        .data-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem; margin-bottom: 1.5rem; }
        .data-item { background: #f9fafb; padding: 1rem; border-radius: 0.5rem; border-left: 4px solid #667eea; text-align: center; }
        .number-button { background: #667eea; color: white; padding: 0.5rem 1rem; border-radius: 0.375rem; font-size: 1.5rem; font-weight: bold; cursor: pointer; display: inline-block; border: none; }
        .number-button.active { background: #48bb78; }
        .result-section { margin-bottom: 2rem; border: 1px solid #e5e7eb; border-radius: 0.75rem; overflow: hidden; }
        .section-header { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 1rem 1.5rem; font-weight: bold; }
        .pythagorean-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 0.5rem; max-width: 300px; margin: 1rem auto; }
        .pythagorean-cell { aspect-ratio: 1; display: flex; align-items: center; justify-content: center; background: #f3f4f6; border: 2px solid #d1d5db; border-radius: 0.5rem; font-weight: bold; }
        .pythagorean-cell.active { background: #667eea; color: white; }
    </style>
</head>
<body class="bg-gray-50">

    <div class="container mx-auto px-4 py-8 max-w-6xl">
        <div class="text-center mb-6 p-4 bg-gradient-to-r from-purple-600 to-blue-600 rounded-lg shadow-lg">
            <h1 class="text-3xl font-bold text-white mb-2"><i class="fas fa-chart-line mr-3"></i>üîÆ ‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå Psychomatrix</h1>
        </div>

        <div class="tab-container">
            <div class="tab-buttons">
                <button class="tab-button active" onclick="switchTab('Main', this)"><i class="fas fa-chart-bar mr-2"></i>Main</button>
                <button class="tab-button" onclick="switchTab('Explained', this)"><i class="fas fa-book-open mr-2"></i>Explained</button>
            </div>
            
            <div class="tab-content">
                <div id="Main" class="tab-pane active">
                    <div id="loadingStatus" class="p-4 bg-yellow-50 rounded-lg border border-yellow-200 text-gray-700">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...</div>
                    <div id="resultsContainer" class="hidden space-y-8"></div>
                </div>
                <div id="Explained" class="tab-pane">
                    <div class="explained-content text-center py-12 text-gray-500">
                        <i class="fas fa-hand-pointer text-4xl mb-4"></i>
                        <p>‡∏Ñ‡∏•‡∏¥‡∏Å‡∏ó‡∏µ‡πà‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç‡πÉ‡∏ô‡πÅ‡∏ó‡πá‡∏ö Main ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏π‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // üõ†Ô∏è ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö Path ‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥ (‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏ó‡∏±‡πâ‡∏á GitHub ‡πÅ‡∏•‡∏∞ Local Server)
        const currentPath = window.location.pathname;
        const folderPath = currentPath.substring(0, currentPath.lastIndexOf('/'));
        const CONTENTS_DIR = 'PsychomatrixContents';
        
        // ‡∏™‡∏£‡πâ‡∏≤‡∏á URL ‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Content (Relative)
        const CONTENT_BASE_URL = `${folderPath}/${CONTENTS_DIR}`;

        document.addEventListener('DOMContentLoaded', loadAndDisplayResult);

        function switchTab(tabName, buttonElement) {
            document.querySelectorAll('.tab-pane').forEach(p => p.classList.remove('active'));
            document.querySelectorAll('.tab-button').forEach(b => b.classList.remove('active'));
            document.getElementById(tabName).classList.add('active');
            buttonElement.classList.add('active');
        }

        function loadAndDisplayResult() {
            const resultData = sessionStorage.getItem('psychomatrixResult');
            if (!resultData) return;

            const data = JSON.parse(resultData);
            let html = '';
            
            if (data.results) {
                data.results.forEach(res => html += createResultSection(res.data, res.title));
            } else {
                html += createResultSection(data, 'üìÖ ‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå');
            }

            document.getElementById('resultsContainer').innerHTML = html;
            document.getElementById('loadingStatus').classList.add('hidden');
            document.getElementById('resultsContainer').classList.remove('hidden');
        }

        function createResultSection(data, title) {
            return `
                <div class="result-section">
                    <div class="section-header">${title}</div>
                    <div class="section-content p-6">
                        <div class="data-grid">
                            ${renderNumberItem('Destiny', data.destiny_number, 'Destiny')}
                            ${renderNumberItem('Life Path', data.life_path_number, 'LifePathNumber')}
                            ${renderNumberItem('Life Lesson', data.thirdAndFourth?.lifeLesson, 'KarmicLesson')}
                        </div>
                    </div>
                </div>`;
        }

        function renderNumberItem(label, num, filePrefix) {
            if (!num) return `<div class="data-item"><div class="label">${label}</div>-</div>`;
            const fileUrl = `${CONTENT_BASE_URL}/${filePrefix}${num}.html`;
            return `
                <div class="data-item">
                    <div class="label text-sm text-gray-500 mb-2">${label}</div>
                    <button class="number-button" onclick="loadContent('${fileUrl}', '${label}', ${num})">${num}</button>
                </div>`;
        }

        function loadContent(url, category, num) {
            const container = document.querySelector('#Explained .explained-content');
            container.innerHTML = '<i class="fas fa-spinner fa-spin"></i> ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...';
            switchTab('Explained', document.querySelectorAll('.tab-button')[1]);

            fetch(url)
                .then(r => r.text())
                .then(html => {
                    const parser = new DOMParser();
                    const doc = parser.parseFromString(html, 'text/html');
                    
                    // üñºÔ∏è ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç Path ‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡πÉ‡∏´‡πâ‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡∏ï‡∏≤‡∏°‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡πÑ‡∏ü‡∏•‡πå Content
                    doc.querySelectorAll('img').forEach(img => {
                        const src = img.getAttribute('src');
                        if (src && !src.startsWith('http') && !src.startsWith('/')) {
                            img.src = `${CONTENT_BASE_URL}/${src}`;
                        }
                    });

                    container.innerHTML = `
                        <div class="p-4 bg-blue-50 border-l-4 border-blue-500 mb-4">
                            <h2 class="text-2xl font-bold">${category} ${num}</h2>
                        </div>
                        <div class="prose max-w-none">${doc.body.innerHTML}</div>`;
                })
                .catch(err => {
                    container.innerHTML = `<p class="text-red-500">‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•: ${url}</p>`;
                });
        }
    </script>
</body>
</html>
