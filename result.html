<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Psychomatrix Analysis Results</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">


    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-annotation@2.0.0"></script>
    
    <!-- Psychomatrix Main CSS -->
    <link rel="stylesheet" href="css/PsychomatrixStyle.css">
    <link rel="stylesheet" href="css/result-style.css">

    <!-- Supabase -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

    <!-- Favicon -->
    <link rel="icon" href="images/PsychomatixAnalize.png" type="image/png">
    
    <!-- Tailwind config -->
    <script>
    tailwind.config = {
        prefix: 'tw-',
        corePlugins: {
            preflight: false
        }
    }
    </script>
    
    
</head>
<body class="tw-max-w-4xl tw-mx-h-auto tw-mx-auto tw-bg-gray-100 tw-p-2 tw-mb-1" onload="console.log('‚úÖ DEBUG: Page loaded completely')">

    <!-- Tab Buttons -->
    <div class="tw-max-w-4xl tw-mx-h-auto tw-mx-auto tw-rounded tw-shadow">
        <button class="tablink" onclick="switchTab('Main', this)" id="defaultOpen">Main</button>
        <button class="tablink" onclick="switchTab('Explained', this)">Explained</button>
    </div>
    
    <!-- Main Tab -->
    <div id="Main" class="tabcontent printable tw-max-w-4xl tw-mx-h-auto tw-mx-auto tw-bg-white tw-p-6 tw-rounded tw-shadow tw-mt-6 tw-mb-1 tw-overflow-y-auto tw-max-h-[90vh] active">
        <h1 class="tw-text-3xl tw-font-bold tw-text-center tw-mb-2 tw-flex tw-items-center tw-justify-center">
            <img src="images/PsychomatixAnalize.png" alt="Psychomatrix Logo" class="tw-h-18 tw-w-18 tw-mr-4">
            Psychomatrix Analysis
        </h1>
        
        <!-- Loading State -->
        <div id="loadingSection" class="tw-text-center tw-py-8">
            <div class="spinner"></div>
            <p class="tw-mt-4 tw-text-gray-600">Loading analysis results...</p>
            <p id="loadingDetails" class="tw-mt-2 tw-text-sm tw-text-gray-500"></p>
        </div>
        
        <!-- Error State -->
        <div id="errorSection" class="tw-hidden tw-text-center tw-py-8">
            <div class="tw-text-red-500 tw-text-4xl tw-mb-4">‚ö†Ô∏è</div>
            <h3 class="tw-text-xl tw-font-semibold tw-text-red-600">No analysis data found</h3>
            <p id="errorMessage" class="tw-text-gray-600 tw-mt-2">Please fill in the data on Psychomatrix.html first</p>
            <div id="debugInfo" class="tw-mt-4 tw-p-4 tw-bg-gray-100 tw-rounded tw-text-left tw-text-sm tw-font-mono tw-hidden">
                <p><strong>Debug Information:</strong></p>
                <p id="debugSessionStorage"></p>
                <p id="debugURLParams"></p>
                <p id="debugLocalStorage"></p>
            </div>
            <button onclick="window.location.href='Psychomatrix.html'" class="tw-mt-4 tw-bg-blue-500 hover:tw-bg-blue-600 tw-text-white tw-font-bold tw-py-2 tw-px-6 tw-rounded">
                Return to Input Form
            </button>
            <button onclick="toggleDebugInfo()" class="tw-mt-2 tw-bg-gray-500 hover:tw-bg-gray-600 tw-text-white tw-font-bold tw-py-2 tw-px-6 tw-rounded">
                Show Debug Info
            </button>
        </div>
        
        <!-- Results Container -->
        <div id="resultsContainer" class="tw-hidden">
            <!-- Results will be inserted here -->
        </div>
        
        <div class="tw-mt-4 tw-text-right">
            <span onclick="window.location.href='Psychomatrix.html'" class="tw-text-blue-500 hover:tw-underline tw-cursor-pointer">Return to Input Form</span>
        </div>
    </div>
    
    <!-- Explained Tab -->
    <div id="Explained" class="tabcontent printable tw-max-w-4xl tw-mx-h-auto tw-mx-auto tw-bg-white tw-p-6 tw-rounded tw-shadow tw-mt-6 tw-mb-1 tw-overflow-y-auto tw-max-h-[90vh]">
        <div id="explainedContent" class="explained-content"></div>
    </div>

    <script src="js/supabase-config.js"></script>
    <script src="js/auth_status_manager.js"></script>

    <!-- JavaScript Files -->
    <script src="js/pythagorean.js?v=10.10"></script>
    <script src="js/pinnacle.js?v=1.00"></script>
    <script src="js/result.js?v=11.00"></script>


    <script src="js/debug-logger.js"></script>

    <!-- ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÉ‡∏ô result.html ‡∏Å‡πà‡∏≠‡∏ô </body> -->
    <script>
        // ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤ result.html ‡πÉ‡∏´‡πâ‡πÉ‡∏ä‡πâ navigation ‡∏ó‡∏µ‡πà‡∏ï‡πà‡∏≤‡∏á‡∏≠‡∏≠‡∏Å‡πÑ‡∏õ
        document.addEventListener('DOMContentLoaded', async function() {
            console.log("üîê Checking login status for profile page...");
    
            // ‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÑ‡∏´‡∏°
            console.log("checkCurrentSession:", typeof checkCurrentSession);
            console.log("checkSupabaseSessionAndNav:", typeof checkSupabaseSessionAndNav);
            console.log("Swal:", typeof Swal);
    
            // ‡πÉ‡∏ä‡πâ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏≠‡∏¢‡∏π‡πà‡πÅ‡∏•‡πâ‡∏ß
            await checkSupabaseSessionAndNav();

            // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ß‡πà‡∏≤ session ‡∏°‡∏µ‡∏≠‡∏¢‡∏π‡πà‡∏à‡∏£‡∏¥‡∏á
            const session = await checkCurrentSession();
    
            console.log("Session:", session);
    
            if (!session) {
                console.log("No session found, redirecting to login...");
        
                // ‡∏•‡∏≠‡∏á‡πÉ‡∏ä‡πâ alert ‡πÅ‡∏ö‡∏ö‡∏ò‡∏£‡∏£‡∏°‡∏î‡∏≤‡∏Å‡πà‡∏≠‡∏ô
                alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏•‡πá‡∏≠‡∏Å‡∏≠‡∏¥‡∏ô‡∏Å‡πà‡∏≠‡∏ô‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á‡∏´‡∏ô‡πâ‡∏≤‡∏ô‡∏µ‡πâ');
                window.location.href = 'index.html';
                return;
            }

            // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡πÄ‡∏õ‡πá‡∏ô‡∏´‡∏ô‡πâ‡∏≤ result.html ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
            if (window.location.pathname.includes('result.html')) {
                const customNavHTML = `
                    <nav class="tw-bg-gradient-to-r tw-from-blue-800 tw-to-purple-800 tw-p-4 tw-shadow-md">
                        <div class="tw-container tw-mx-auto tw-flex tw-justify-between tw-items-center">
                            <a href="Psychomatrix.html" class="tw-text-white tw-font-bold tw-text-lg hover:tw-text-blue-200">
                                <img src="images/PsychomatixAnalize.png" alt="Logo" class="tw-h-8 tw-w-8 tw-inline tw-mr-2">
                                Psychomatrix Analysis
                            </a>
                            <div class="tw-flex tw-space-x-4">
                                <a href="psychomatrix_hub.html" class="tw-text-white hover:tw-text-blue-200">
                                    <i class="fas fa-home tw-mr-1"></i>Home Psychomatrix
                                </a>
                            </div>
                        </div>
                    </nav>
                `;
            
                // ‡πÅ‡∏ó‡∏£‡∏Å navigation ‡∏ó‡∏µ‡πà‡∏™‡πà‡∏ß‡∏ô‡∏ö‡∏ô‡∏Ç‡∏≠‡∏á body
                document.body.insertAdjacentHTML('afterbegin', customNavHTML);
            
                // ‡∏õ‡∏£‡∏±‡∏ö margin ‡∏Ç‡∏≠‡∏á content ‡∏î‡πâ‡∏≤‡∏ô‡∏•‡πà‡∏≤‡∏á
                document.querySelector('.tabcontent').style.marginTop = '20px';
            }
        });
    </script>


</body>
</html>
