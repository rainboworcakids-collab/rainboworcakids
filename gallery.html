<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡πÅ‡∏Å‡∏•‡πÄ‡∏•‡∏≠‡∏£‡∏µ‡πà‡∏ú‡∏•‡∏á‡∏≤‡∏ô - RainbowOrcaKids</title>
    
    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <style>
        .video-card {
            transition: all 0.3s ease;
        }
        .video-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 30px rgba(0,0,0,0.1);
        }
        .star {
            cursor: pointer;
            transition: color 0.2s;
        }
        .star.active {
            color: #fbbf24;
        }
        .animate-slide-in {
            animation: slideIn 0.3s ease-out;
        }
        .animate-slide-out {
            animation: slideOut 0.3s ease-in;
        }
        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        @keyframes slideOut {
            from { transform: translateX(0); opacity: 1; }
            to { transform: translateX(100%); opacity: 0; }
        }
    </style>
    <script src="js/nav.js"></script>
    
</head>
<body class="font-sarabun bg-gray-50">
    <!-- Navigation bar ‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÇ‡∏î‡∏¢ js/nav.js -->
    
    <!-- Main Content -->
    <div class="min-h-screen pt-16">
        <!-- Header -->
        <div class="bg-gradient-to-r from-purple-600 to-indigo-600 text-white py-12">
            <div class="container mx-auto px-4">
                <h1 class="text-4xl font-bold mb-4">‡πÅ‡∏Å‡∏•‡πÄ‡∏•‡∏≠‡∏£‡∏µ‡πà‡∏ú‡∏•‡∏á‡∏≤‡∏ô‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</h1>
                <p class="text-lg opacity-90">‡∏ä‡∏°‡∏ú‡∏•‡∏á‡∏≤‡∏ô‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏™‡∏£‡∏£‡∏Ñ‡πå‡∏à‡∏≤‡∏Å‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏ó‡∏±‡πà‡∏ß‡∏õ‡∏£‡∏∞‡πÄ‡∏ó‡∏® ‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏´‡πâ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡πÅ‡∏•‡∏∞‡πÅ‡∏™‡∏î‡∏á‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏¥‡∏î‡πÄ‡∏´‡πá‡∏ô</p>
            </div>
        </div>
        
        <!-- Stats Summary -->
        <div class="container mx-auto px-4 -mt-6">
            <div id="statsSummary" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                <!-- Stats ‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡πÇ‡∏´‡∏•‡∏î‡πÇ‡∏î‡∏¢ gallery-app.js -->
                <div class="text-center">
                    <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-purple-600 mx-auto"></div>
                </div>
            </div>
        </div>
        
        <!-- Filters and Controls -->
        <div class="container mx-auto px-4 mb-8">
            <div class="bg-white rounded-xl shadow-md p-6">
                <div class="flex flex-col md:flex-row md:items-center justify-between space-y-4 md:space-y-0">
                    <div class="flex flex-col md:flex-row md:items-center space-y-4 md:space-y-0 md:space-x-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏ï‡∏≤‡∏°</label>
                            <select id="sortBy" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500 md:w-48">
                                <option value="newest">‡πÉ‡∏´‡∏°‡πà‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î</option>
                                <option value="popular">‡∏¢‡∏≠‡∏î‡∏ô‡∏¥‡∏¢‡∏°</option>
                                <option value="rating">‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">‡∏†‡∏≤‡∏£‡∏Å‡∏¥‡∏à</label>
                            <select id="missionFilter" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500 md:w-48">
                                <option value="all">‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏ä‡∏±‡πâ‡∏ô</label>
                            <select id="gradeFilter" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500 md:w-48">
                                <option value="all">‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</option>
                                <option value="1">‡∏õ‡∏£‡∏∞‡∏ñ‡∏° 1</option>
                                <option value="2">‡∏õ‡∏£‡∏∞‡∏ñ‡∏° 2</option>
                                <option value="3">‡∏õ‡∏£‡∏∞‡∏ñ‡∏° 3</option>
                                <option value="4">‡∏õ‡∏£‡∏∞‡∏ñ‡∏° 4</option>
                                <option value="5">‡∏õ‡∏£‡∏∞‡∏ñ‡∏° 5</option>
                                <option value="6">‡∏õ‡∏£‡∏∞‡∏ñ‡∏° 6</option>
                            </select>
                        </div>
                    </div>
                    <button id="applyFilters" class="bg-purple-600 hover:bg-purple-700 text-white px-6 py-3 rounded-lg font-semibold w-full md:w-auto mt-4 md:mt-0">
                        <i class="fas fa-filter mr-2"></i>‡∏Å‡∏£‡∏≠‡∏á‡∏ú‡∏•‡∏á‡∏≤‡∏ô
                    </button>
                </div>
            </div>
        </div>
        
        <!-- Gallery Grid -->
        <div class="container mx-auto px-4 mb-12">
            <div id="galleryGrid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6">
                <!-- ‡∏ú‡∏•‡∏á‡∏≤‡∏ô‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡πÇ‡∏´‡∏•‡∏î‡πÇ‡∏î‡∏¢ gallery-app.js -->
                <div class="col-span-full text-center py-12">
                    <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-purple-600 mx-auto mb-4"></div>
                    <p class="text-gray-600">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏ú‡∏•‡∏á‡∏≤‡∏ô...</p>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Rating Modal -->
    <div id="ratingModal" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden">
        <div id="ratingModalContent" class="bg-white rounded-xl shadow-xl max-w-md mx-auto mt-20 p-6">
            <h3 class="text-xl font-bold mb-4">‡πÉ‡∏´‡πâ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏ú‡∏•‡∏á‡∏≤‡∏ô</h3>
            <div class="flex justify-center mb-4">
                <i class="star far fa-star text-3xl mx-1" data-rating="1"></i>
                <i class="star far fa-star text-3xl mx-1" data-rating="2"></i>
                <i class="star far fa-star text-3xl mx-1" data-rating="3"></i>
                <i class="star far fa-star text-3xl mx-1" data-rating="4"></i>
                <i class="star far fa-star text-3xl mx-1" data-rating="5"></i>
            </div>
            <p id="ratingText" class="text-center text-gray-600 mb-4">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏î‡∏≤‡∏ß‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÉ‡∏´‡πâ</p>
            <div class="mb-4">
                <label class="block text-sm font-medium text-gray-700 mb-2">‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏¥‡∏î‡πÄ‡∏´‡πá‡∏ô (‡πÑ‡∏°‡πà‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô)</label>
                <textarea id="ratingComment" rows="3" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500" placeholder="‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏¥‡∏î‡πÄ‡∏´‡πá‡∏ô..."></textarea>
            </div>
            <div class="flex justify-end space-x-3">
                <button id="cancelRating" class="px-4 py-2 text-gray-600 hover:text-gray-800">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
                <button id="submitRating" class="bg-purple-600 hover:bg-purple-700 text-white px-4 py-2 rounded-lg">‡∏™‡πà‡∏á‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô</button>
            </div>
        </div>
    </div>
    
    <!-- Report Modal -->
    <div id="reportModal" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden">
        <div id="reportModalContent" class="bg-white rounded-xl shadow-xl max-w-md mx-auto mt-20 p-6">
            <h3 class="text-xl font-bold mb-4">‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏ú‡∏•‡∏á‡∏≤‡∏ô</h3>
            <div class="mb-4">
                <label class="block text-sm font-medium text-gray-700 mb-2">‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏•‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô</label>
                <div class="space-y-2">
                    <label class="flex items-center">
                        <input type="radio" name="reportReason" value="inappropriate" class="mr-2">
                        <span>‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤‡πÑ‡∏°‡πà‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏°</span>
                    </label>
                    <label class="flex items-center">
                        <input type="radio" name="reportReason" value="spam" class="mr-2">
                        <span>‡∏™‡πÅ‡∏õ‡∏°‡∏´‡∏£‡∏∑‡∏≠‡πÇ‡∏Ü‡∏©‡∏ì‡∏≤</span>
                    </label>
                    <label class="flex items-center">
                        <input type="radio" name="reportReason" value="copyright" class="mr-2">
                        <span>‡∏•‡∏∞‡πÄ‡∏°‡∏¥‡∏î‡∏•‡∏¥‡∏Ç‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå</span>
                    </label>
                    <label class="flex items-center">
                        <input type="radio" name="reportReason" value="other" class="mr-2">
                        <span>‡∏≠‡∏∑‡πà‡∏ô ‡πÜ</span>
                    </label>
                </div>
            </div>
            <div class="mb-4">
                <label class="block text-sm font-medium text-gray-700 mb-2">‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°</label>
                <textarea id="reportDetails" rows="3" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500" placeholder="‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏∞‡∏ö‡∏∏‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î..."></textarea>
            </div>
            <div class="flex justify-end space-x-3">
                <button id="cancelReport" class="px-4 py-2 text-gray-600 hover:text-gray-800">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
                <button id="submitReport" class="bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded-lg">‡∏™‡πà‡∏á‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô</button>
            </div>
        </div>
    </div>
    
    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    
    <!-- ‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏ü‡∏•‡πå JS ‡∏ï‡∏≤‡∏°‡∏•‡∏≥‡∏î‡∏±‡∏ö‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á -->
    <script src="js/supabase-config.js"></script>
    <script src="js/auth_status_manager.js"></script>
    
    <script>
        // Gallery JavaScript
        let supabase = null;
        let currentUser = null;
        let currentSubmissionId = null;
        let allMissions = [];
        
        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏£‡∏≠‡πÉ‡∏´‡πâ nav.js ‡πÇ‡∏´‡∏•‡∏î‡πÄ‡∏™‡∏£‡πá‡∏à
        function waitForNav() {
            return new Promise((resolve) => {
                let attempts = 0;
                const maxAttempts = 30;
                
                const checkNav = setInterval(() => {
                    attempts++;
                    
                    // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤ navigation bar ‡∏ñ‡∏π‡∏Å‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÅ‡∏•‡πâ‡∏ß‡∏´‡∏£‡∏∑‡∏≠‡∏¢‡∏±‡∏á
                    const navExists = document.querySelector('nav');
                    
                    if (navExists) {
                        clearInterval(checkNav);
                        console.log("‚úÖ Navigation bar loaded");
                        resolve();
                    } else if (attempts >= maxAttempts) {
                        clearInterval(checkNav);
                        console.warn("‚ùå Navigation bar not loaded, continuing anyway");
                        resolve();
                    }
                }, 100);
            });
        }
        
        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡πÅ‡∏Å‡∏•‡πÄ‡∏•‡∏≠‡∏£‡∏µ‡πà
        async function initGallery() {
            try {
                console.log("üîÑ Initializing gallery...");
                
                // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡∏°‡∏µ SupabaseConfig ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
                if (window.SupabaseConfig && window.SupabaseConfig.client) {
                    supabase = window.SupabaseConfig.client();
                    console.log("‚úÖ Using SupabaseConfig client");
                } else if (window.supabaseClient) {
                    supabase = window.supabaseClient;
                    console.log("‚úÖ Using window.supabaseClient");
                } else if (window.initializeSupabaseClient) {
                    supabase = window.initializeSupabaseClient();
                    console.log("‚úÖ Using initializeSupabaseClient");
                } else {
                    throw new Error("Supabase client not available");
                }
                
                if (!supabase) {
                    throw new Error("Failed to initialize Supabase client");
                }
                
                // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡∏•‡πá‡∏≠‡∏Å‡∏≠‡∏¥‡∏ô
                const { data: { session } } = await supabase.auth.getSession();
                
                if (!session) {
                    // ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏•‡πá‡∏≠‡∏Å‡∏≠‡∏¥‡∏ô ‡πÉ‡∏´‡πâ‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°
                    showNotLoggedInMessage();
                    return;
                }
                
                currentUser = session.user;
                console.log("‚úÖ User authenticated:", currentUser.email);
                
                // ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ event listeners
                setupEventListeners();
                
                // ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏†‡∏≤‡∏£‡∏Å‡∏¥‡∏à
                await loadMissions();
                
                // ‡πÇ‡∏´‡∏•‡∏î‡∏ú‡∏•‡∏á‡∏≤‡∏ô
                await loadSubmissions();
                
                // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥
                await updateStats();
                
            } catch (error) {
                console.error("‚ùå Error initializing gallery:", error);
                showError('‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÇ‡∏´‡∏•‡∏î‡πÅ‡∏Å‡∏•‡πÄ‡∏•‡∏≠‡∏£‡∏µ‡πà‡πÑ‡∏î‡πâ: ' + error.message);
            }
        }
        
        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Å‡∏£‡∏ì‡∏µ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏•‡πá‡∏≠‡∏Å‡∏≠‡∏¥‡∏ô
        function showNotLoggedInMessage() {
            const galleryGrid = document.getElementById('galleryGrid');
            galleryGrid.innerHTML = `
                <div class="col-span-full text-center py-12">
                    <div class="bg-yellow-50 border border-yellow-200 rounded-lg p-8 max-w-md mx-auto">
                        <i class="fas fa-exclamation-triangle text-yellow-500 text-4xl mb-4"></i>
                        <h3 class="text-xl font-bold text-yellow-700 mb-2">‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏•‡πá‡∏≠‡∏Å‡∏≠‡∏¥‡∏ô</h3>
                        <p class="text-gray-600 mb-4">‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡∏•‡πá‡∏≠‡∏Å‡∏≠‡∏¥‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏Ç‡πâ‡∏≤‡∏ä‡∏°‡πÅ‡∏Å‡∏•‡πÄ‡∏•‡∏≠‡∏£‡∏µ‡πà‡∏ú‡∏•‡∏á‡∏≤‡∏ô</p>
                        <a href="login_supabase.html" class="inline-block bg-purple-600 hover:bg-purple-700 text-white px-6 py-3 rounded-lg font-semibold">
                            <i class="fas fa-sign-in-alt mr-2"></i>‡πÑ‡∏õ‡∏´‡∏ô‡πâ‡∏≤‡∏•‡πá‡∏≠‡∏Å‡∏≠‡∏¥‡∏ô
                        </a>
                    </div>
                </div>
            `;
            
            // ‡∏ã‡πà‡∏≠‡∏ô filter section
            document.querySelector('.bg-white.rounded-xl').style.display = 'none';
        }
        
        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÇ‡∏´‡∏•‡∏î‡∏†‡∏≤‡∏£‡∏Å‡∏¥‡∏à‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö filter
        async function loadMissions() {
            try {
                const { data: missions, error } = await supabase
                    .from('missions')
                    .select('mission_id, mission_title')
                    .order('mission_title');
                
                if (error) throw error;
                
                allMissions = missions || [];
                const missionFilter = document.getElementById('missionFilter');
                
                // ‡πÄ‡∏û‡∏¥‡πà‡∏° options
                missions.forEach(mission => {
                    const option = document.createElement('option');
                    option.value = mission.mission_id;
                    option.textContent = mission.mission_title;
                    missionFilter.appendChild(option);
                });
                
            } catch (error) {
                console.error('Error loading missions:', error);
            }
        }
        
        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÇ‡∏´‡∏•‡∏î‡∏ú‡∏•‡∏á‡∏≤‡∏ô
        async function loadSubmissions() {
            const galleryGrid = document.getElementById('galleryGrid');
            
            try {
                // ‡πÅ‡∏™‡∏î‡∏á loading
                galleryGrid.innerHTML = `
                    <div class="col-span-full text-center py-12">
                        <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-purple-600 mx-auto mb-4"></div>
                        <p class="text-gray-600">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏ú‡∏•‡∏á‡∏≤‡∏ô...</p>
                    </div>
                `;
                
                // ‡∏î‡∏∂‡∏á filter values
                const sortBy = document.getElementById('sortBy').value;
                const missionId = document.getElementById('missionFilter').value;
                const grade = document.getElementById('gradeFilter').value;
                
                // ‡∏™‡∏£‡πâ‡∏≤‡∏á query
                let query = supabase
                    .from('submissions')
                    .select(`
                        *,
                        missions (mission_title),
                        users (display_name, avatar_url)
                    `)
                    .eq('status', 'approved'); // ‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏ú‡∏•‡∏á‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥
                
                // ‡πÉ‡∏ä‡πâ filter ‡∏†‡∏≤‡∏£‡∏Å‡∏¥‡∏à
                if (missionId && missionId !== 'all') {
                    query = query.eq('mission_id', missionId);
                }
                
                // ‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏•‡∏≥‡∏î‡∏±‡∏ö
                if (sortBy === 'newest') {
                    query = query.order('created_at', { ascending: false });
                } else if (sortBy === 'popular') {
                    query = query.order('views', { ascending: false });
                } else if (sortBy === 'rating') {
                    query = query.order('average_rating', { ascending: false });
                }
                
                const { data: submissions, error } = await query;
                
                if (error) throw error;
                
                if (!submissions || submissions.length === 0) {
                    galleryGrid.innerHTML = `
                        <div class="col-span-full text-center py-12">
                            <i class="fas fa-photo-video text-4xl text-gray-300 mb-4"></i>
                            <p class="text-gray-500">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ú‡∏•‡∏á‡∏≤‡∏ô‡πÉ‡∏ô‡πÅ‡∏Å‡∏•‡πÄ‡∏•‡∏≠‡∏£‡∏µ‡πà</p>
                            <p class="text-gray-400 text-sm mt-2">‡πÄ‡∏õ‡πá‡∏ô‡∏Ñ‡∏ô‡πÅ‡∏£‡∏Å‡∏ó‡∏µ‡πà‡∏™‡πà‡∏á‡∏ú‡∏•‡∏á‡∏≤‡∏ô‡πÄ‡∏•‡∏¢!</p>
                            <a href="missions.html" class="inline-block mt-4 bg-purple-600 hover:bg-purple-700 text-white px-6 py-3 rounded-lg font-semibold">
                                <i class="fas fa-rocket mr-2"></i>‡∏î‡∏π‡∏†‡∏≤‡∏£‡∏Å‡∏¥‡∏à‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
                            </a>
                        </div>
                    `;
                    return;
                }
                
                // ‡πÄ‡∏£‡∏ô‡πÄ‡∏î‡∏≠‡∏£‡πå‡∏ú‡∏•‡∏á‡∏≤‡∏ô
                renderSubmissions(submissions);
                
            } catch (error) {
                console.error('Error loading submissions:', error);
                galleryGrid.innerHTML = `
                    <div class="col-span-full text-center py-12">
                        <i class="fas fa-exclamation-triangle text-4xl text-red-300 mb-4"></i>
                        <p class="text-red-500">‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÇ‡∏´‡∏•‡∏î‡∏ú‡∏•‡∏á‡∏≤‡∏ô</p>
                        <button onclick="loadSubmissions()" class="mt-4 px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700">
                            ‡∏•‡∏≠‡∏á‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á
                        </button>
                    </div>
                `;
            }
        }
        
        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÄ‡∏£‡∏ô‡πÄ‡∏î‡∏≠‡∏£‡πå‡∏ú‡∏•‡∏á‡∏≤‡∏ô
        function renderSubmissions(submissions) {
            const galleryGrid = document.getElementById('galleryGrid');
            galleryGrid.innerHTML = '';
            
            submissions.forEach(submission => {
                const card = createSubmissionCard(submission);
                galleryGrid.appendChild(card);
            });
        }
        
        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡πå‡∏î‡∏ú‡∏•‡∏á‡∏≤‡∏ô
        function createSubmissionCard(submission) {
            const card = document.createElement('div');
            card.className = 'video-card bg-white rounded-xl shadow-md overflow-hidden';
            
            // ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà
            const submittedDate = new Date(submission.created_at);
            const timeAgo = getTimeAgo(submittedDate);
            
            card.innerHTML = `
                <div class="relative">
                    <!-- Video Thumbnail -->
                    <div class="aspect-video bg-gray-800 relative overflow-hidden">
                        <img src="https://img.youtube.com/vi/${getYouTubeId(submission.video_url)}/hqdefault.jpg" 
                             alt="Video thumbnail" 
                             class="w-full h-full object-cover">
                        <div class="absolute inset-0 bg-black bg-opacity-30 flex items-center justify-center">
                            <div class="w-16 h-16 bg-white bg-opacity-80 rounded-full flex items-center justify-center">
                                <i class="fas fa-play text-purple-600 text-2xl"></i>
                            </div>
                        </div>
                        <div class="absolute top-3 right-3 bg-black bg-opacity-60 text-white text-xs px-2 py-1 rounded">
                            <i class="fas fa-clock mr-1"></i>${submission.duration || '3:45'}
                        </div>
                    </div>
                    
                    <!-- Content -->
                    <div class="p-4">
                        <h3 class="font-bold text-gray-800 mb-2 line-clamp-2" title="${submission.title || '‡∏ú‡∏•‡∏á‡∏≤‡∏ô‡∏ß‡∏¥‡∏î‡∏µ‡πÇ‡∏≠'}">
                            ${submission.title || '‡∏ú‡∏•‡∏á‡∏≤‡∏ô‡∏ß‡∏¥‡∏î‡∏µ‡πÇ‡∏≠'}
                        </h3>
                        
                        <!-- User Info -->
                        <div class="flex items-center mb-3">
                            <div class="w-8 h-8 bg-purple-500 rounded-full flex items-center justify-center text-white text-sm font-bold mr-2 overflow-hidden">
                                ${submission.users?.avatar_url ? 
                                    `<img src="${submission.users.avatar_url}" alt="" class="w-full h-full object-cover">` :
                                    `<span>${(submission.users?.display_name || '‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ').charAt(0)}</span>`
                                }
                            </div>
                            <div class="flex-1">
                                <div class="text-sm font-medium text-gray-700">${submission.users?.display_name || '‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ'}</div>
                                <div class="text-xs text-gray-500">${timeAgo}</div>
                            </div>
                        </div>
                        
                        <!-- Mission Info -->
                        <div class="mb-3">
                            <span class="inline-block bg-purple-100 text-purple-700 text-xs font-medium px-2 py-1 rounded">
                                ${submission.missions?.mission_title || '‡∏†‡∏≤‡∏£‡∏Å‡∏¥‡∏à'}
                            </span>
                        </div>
                        
                        <!-- Stats -->
                        <div class="flex justify-between text-sm text-gray-600">
                            <div class="flex items-center">
                                <i class="fas fa-eye mr-1"></i>
                                <span>${submission.views || 0}</span>
                            </div>
                            <div class="flex items-center">
                                <i class="fas fa-thumbs-up mr-1"></i>
                                <span>${submission.likes || 0}</span>
                            </div>
                            <div class="flex items-center">
                                <i class="fas fa-star mr-1 text-yellow-500"></i>
                                <span>${submission.average_rating?.toFixed(1) || '0.0'}</span>
                            </div>
                            <div class="flex items-center">
                                <i class="fas fa-comment mr-1"></i>
                                <span>${submission.comment_count || 0}</span>
                            </div>
                        </div>
                        
                        <!-- Actions -->
                        <div class="mt-4 flex space-x-2">
                            <button onclick="handleVote('${submission.id}', 'like')" 
                                    class="flex-1 bg-blue-100 hover:bg-blue-200 text-blue-700 px-3 py-2 rounded-lg text-sm font-medium flex items-center justify-center">
                                <i class="fas fa-thumbs-up mr-1"></i> ‡∏ä‡∏≠‡∏ö
                            </button>
                            <button onclick="openRatingModal('${submission.id}')" 
                                    class="flex-1 bg-yellow-100 hover:bg-yellow-200 text-yellow-700 px-3 py-2 rounded-lg text-sm font-medium flex items-center justify-center">
                                <i class="fas fa-star mr-1"></i> ‡πÉ‡∏´‡πâ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô
                            </button>
                        </div>
                    </div>
                </div>
            `;
            
            // ‡πÄ‡∏û‡∏¥‡πà‡∏° event listener ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Ñ‡∏•‡∏¥‡∏Å‡∏ó‡∏µ‡πà‡∏Å‡∏≤‡∏£‡πå‡∏î‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏õ‡∏¥‡∏î‡∏ß‡∏¥‡∏î‡∏µ‡πÇ‡∏≠
            card.querySelector('.aspect-video').addEventListener('click', () => {
                openVideoModal(submission);
            });
            
            return card;
        }
        
        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏µ‡πà‡∏ú‡πà‡∏≤‡∏ô‡∏°‡∏≤
        function getTimeAgo(date) {
            const now = new Date();
            const diffMs = now - date;
            const diffSec = Math.floor(diffMs / 1000);
            const diffMin = Math.floor(diffSec / 60);
            const diffHour = Math.floor(diffMin / 60);
            const diffDay = Math.floor(diffHour / 24);
            
            if (diffDay > 0) return `${diffDay} ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÅ‡∏•‡πâ‡∏ß`;
            if (diffHour > 0) return `${diffHour} ‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á‡∏ó‡∏µ‡πà‡πÅ‡∏•‡πâ‡∏ß`;
            if (diffMin > 0) return `${diffMin} ‡∏ô‡∏≤‡∏ó‡∏µ‡∏ó‡∏µ‡πà‡πÅ‡∏•‡πâ‡∏ß`;
            return '‡πÑ‡∏°‡πà‡∏Å‡∏µ‡πà‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ‡∏ó‡∏µ‡πà‡πÅ‡∏•‡πâ‡∏ß';
        }
        
        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏î‡∏∂‡∏á YouTube ID ‡∏à‡∏≤‡∏Å URL
        function getYouTubeId(url) {
            if (!url) return 'dQw4w9WgXcQ'; // Default video ID
            
            const regExp = /^.*(youtu.be\/|v\/|u\/\w\/|embed\/|watch\?v=|&v=)([^#&?]*).*/;
            const match = url.match(regExp);
            
            return (match && match[2].length === 11) ? match[2] : 'dQw4w9WgXcQ';
        }
        
        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÄ‡∏õ‡∏¥‡∏î modal ‡∏ß‡∏¥‡∏î‡∏µ‡πÇ‡∏≠
        function openVideoModal(submission) {
            // ‡∏™‡∏£‡πâ‡∏≤‡∏á modal ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÅ‡∏™‡∏î‡∏á‡∏ß‡∏¥‡∏î‡∏µ‡πÇ‡∏≠
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-75 z-50 flex items-center justify-center p-4';
            modal.innerHTML = `
                <div class="bg-white rounded-xl w-full max-w-4xl overflow-hidden">
                    <div class="p-4 border-b border-gray-200 flex justify-between items-center">
                        <h3 class="text-xl font-bold text-gray-800">${submission.title || '‡∏ú‡∏•‡∏á‡∏≤‡∏ô‡∏ß‡∏¥‡∏î‡∏µ‡πÇ‡∏≠'}</h3>
                        <button onclick="this.closest('.fixed').remove()" class="text-gray-500 hover:text-gray-700 text-2xl">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                    <div class="aspect-video">
                        <iframe src="https://www.youtube.com/embed/${getYouTubeId(submission.video_url)}" 
                                class="w-full h-full" 
                                frameborder="0" 
                                allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" 
                                allowfullscreen>
                        </iframe>
                    </div>
                    <div class="p-6">
                        <div class="flex items-center mb-4">
                            <div class="w-12 h-12 bg-purple-500 rounded-full flex items-center justify-center text-white text-lg font-bold mr-3 overflow-hidden">
                                ${submission.users?.avatar_url ? 
                                    `<img src="${submission.users.avatar_url}" alt="" class="w-full h-full object-cover">` :
                                    `<span>${(submission.users?.display_name || '‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ').charAt(0)}</span>`
                                }
                            </div>
                            <div>
                                <div class="font-bold text-gray-800">${submission.users?.display_name || '‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ'}</div>
                                <div class="text-sm text-gray-500">${new Date(submission.created_at).toLocaleDateString('th-TH')}</div>
                            </div>
                        </div>
                        <p class="text-gray-700 mb-6">${submission.description || '‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°'}</p>
                        <div class="flex space-x-4">
                            <button onclick="handleVote('${submission.id}', 'like')" 
                                    class="flex-1 bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg font-medium flex items-center justify-center">
                                <i class="fas fa-thumbs-up mr-2"></i> ‡∏ä‡∏≠‡∏ö (${submission.likes || 0})
                            </button>
                            <button onclick="openRatingModal('${submission.id}')" 
                                    class="flex-1 bg-yellow-500 hover:bg-yellow-600 text-white px-4 py-2 rounded-lg font-medium flex items-center justify-center">
                                <i class="fas fa-star mr-2"></i> ‡πÉ‡∏´‡πâ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô (${submission.average_rating?.toFixed(1) || '0.0'})
                            </button>
                        </div>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
            
            // ‡πÄ‡∏û‡∏¥‡πà‡∏° view count
            incrementViewCount(submission.id);
        }
        
        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏à‡∏≥‡∏ô‡∏ß‡∏ô view
        async function incrementViewCount(submissionId) {
            try {
                // ‡∏î‡∏∂‡∏á‡∏à‡∏≥‡∏ô‡∏ß‡∏ô view ‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô
                const { data: submission, error: fetchError } = await supabase
                    .from('submissions')
                    .select('views')
                    .eq('id', submissionId)
                    .single();
                
                if (fetchError) throw fetchError;
                
                // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏à‡∏≥‡∏ô‡∏ß‡∏ô view
                const newViews = (submission.views || 0) + 1;
                const { error: updateError } = await supabase
                    .from('submissions')
                    .update({ views: newViews })
                    .eq('id', submissionId);
                
                if (updateError) throw updateError;
                
            } catch (error) {
                console.error('Error incrementing view count:', error);
            }
        }
        
        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Å‡∏≤‡∏£‡πÇ‡∏´‡∏ß‡∏ï
        async function handleVote(submissionId, type) {
            if (!currentUser) {
                alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏•‡πá‡∏≠‡∏Å‡∏≠‡∏¥‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ô‡∏µ‡πâ');
                return;
            }
            
            try {
                // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡πÄ‡∏Ñ‡∏¢‡πÇ‡∏´‡∏ß‡∏ï‡πÅ‡∏•‡πâ‡∏ß‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
                const { data: existingVote, error: checkError } = await supabase
                    .from('votes')
                    .select('*')
                    .eq('submission_id', submissionId)
                    .eq('user_id', currentUser.id)
                    .eq('type', type)
                    .single();
                
                if (checkError && checkError.code !== 'PGRST116') throw checkError;
                
                if (existingVote) {
                    // ‡∏ñ‡πâ‡∏≤‡πÇ‡∏´‡∏ß‡∏ï‡πÅ‡∏•‡πâ‡∏ß ‡πÉ‡∏´‡πâ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å
                    const { error: deleteError } = await supabase
                        .from('votes')
                        .delete()
                        .eq('id', existingVote.id);
                    
                    if (deleteError) throw deleteError;
                    
                    // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏à‡∏≥‡∏ô‡∏ß‡∏ô likes
                    await updateLikeCount(submissionId, -1);
                    
                    showToast('‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡∏Å‡∏≤‡∏£‡πÇ‡∏´‡∏ß‡∏ï‡πÅ‡∏•‡πâ‡∏ß', 'info');
                } else {
                    // ‡∏ñ‡πâ‡∏≤‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÇ‡∏´‡∏ß‡∏ï ‡πÉ‡∏´‡πâ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÇ‡∏´‡∏ß‡∏ï
                    const { error: insertError } = await supabase
                        .from('votes')
                        .insert({
                            submission_id: submissionId,
                            user_id: currentUser.id,
                            type: type
                        });
                    
                    if (insertError) throw insertError;
                    
                    // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏à‡∏≥‡∏ô‡∏ß‡∏ô likes
                    await updateLikeCount(submissionId, 1);
                    
                    showToast('‡πÇ‡∏´‡∏ß‡∏ï‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!', 'success');
                }
                
                // ‡πÇ‡∏´‡∏•‡∏î‡∏ú‡∏•‡∏á‡∏≤‡∏ô‡πÉ‡∏´‡∏°‡πà
                await loadSubmissions();
                
            } catch (error) {
                console.error('Error handling vote:', error);
                showToast('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÇ‡∏´‡∏ß‡∏ï: ' + error.message, 'error');
            }
        }
        
        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏à‡∏≥‡∏ô‡∏ß‡∏ô likes
        async function updateLikeCount(submissionId, change) {
            try {
                // ‡∏î‡∏∂‡∏á‡∏à‡∏≥‡∏ô‡∏ß‡∏ô likes ‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô
                const { data: submission, error: fetchError } = await supabase
                    .from('submissions')
                    .select('likes')
                    .eq('id', submissionId)
                    .single();
                
                if (fetchError) throw fetchError;
                
                // ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏à‡∏≥‡∏ô‡∏ß‡∏ô likes ‡πÉ‡∏´‡∏°‡πà
                const newLikes = Math.max(0, (submission.likes || 0) + change);
                
                // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï
                const { error: updateError } = await supabase
                    .from('submissions')
                    .update({ likes: newLikes })
                    .eq('id', submissionId);
                
                if (updateError) throw updateError;
                
            } catch (error) {
                console.error('Error updating like count:', error);
                throw error;
            }
        }
        
        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÄ‡∏õ‡∏¥‡∏î modal ‡πÉ‡∏´‡πâ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô
        function openRatingModal(submissionId) {
            if (!currentUser) {
                alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏•‡πá‡∏≠‡∏Å‡∏≠‡∏¥‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô');
                return;
            }
            
            currentSubmissionId = submissionId;
            document.getElementById('ratingModal').classList.remove('hidden');
            
            // ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï stars
            document.querySelectorAll('.star').forEach(star => {
                star.classList.remove('fas', 'active');
                star.classList.add('far');
            });
            
            document.getElementById('ratingText').textContent = '‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏î‡∏≤‡∏ß‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÉ‡∏´‡πâ';
            document.getElementById('ratingComment').value = '';
        }
        
        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏õ‡∏¥‡∏î modal ‡πÉ‡∏´‡πâ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô
        function closeRatingModal() {
            document.getElementById('ratingModal').classList.add('hidden');
            currentSubmissionId = null;
        }
        
        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡πà‡∏á‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô
        async function submitRating() {
            try {
                // ‡∏î‡∏∂‡∏á rating ‡∏à‡∏≤‡∏Å stars ‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å
                const selectedStars = document.querySelectorAll('.star.fas');
                const rating = selectedStars.length;
                
                if (rating === 0) {
                    alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏î‡∏≤‡∏ß');
                    return;
                }
                
                const comment = document.getElementById('ratingComment').value;
                
                // ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å rating ‡∏•‡∏á‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
                const { error } = await supabase
                    .from('ratings')
                    .insert({
                        submission_id: currentSubmissionId,
                        user_id: currentUser.id,
                        rating: rating,
                        comment: comment || null
                    });
                
                if (error) throw error;
                
                // ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì average rating ‡πÉ‡∏´‡∏°‡πà
                await updateAverageRating(currentSubmissionId);
                
                showToast('‡πÉ‡∏´‡πâ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!', 'success');
                closeRatingModal();
                
                // ‡πÇ‡∏´‡∏•‡∏î‡∏ú‡∏•‡∏á‡∏≤‡∏ô‡πÉ‡∏´‡∏°‡πà
                await loadSubmissions();
                
            } catch (error) {
                console.error('Error submitting rating:', error);
                showToast('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÉ‡∏´‡πâ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô: ' + error.message, 'error');
            }
        }
        
        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢
        async function updateAverageRating(submissionId) {
            try {
                // ‡∏î‡∏∂‡∏á ratings ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏Ç‡∏≠‡∏á submission ‡∏ô‡∏µ‡πâ
                const { data: ratings, error } = await supabase
                    .from('ratings')
                    .select('rating')
                    .eq('submission_id', submissionId);
                
                if (error) throw error;
                
                // ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢
                const total = ratings.reduce((sum, item) => sum + item.rating, 0);
                const average = ratings.length > 0 ? total / ratings.length : 0;
                
                // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡πÉ‡∏ô‡∏ï‡∏≤‡∏£‡∏≤‡∏á submissions
                const { error: updateError } = await supabase
                    .from('submissions')
                    .update({ average_rating: average })
                    .eq('id', submissionId);
                
                if (updateError) throw updateError;
                
            } catch (error) {
                console.error('Error updating average rating:', error);
                throw error;
            }
        }
        
        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÄ‡∏õ‡∏¥‡∏î modal ‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô
        function openReportModal(submissionId) {
            currentSubmissionId = submissionId;
            document.getElementById('reportModal').classList.remove('hidden');
        }
        
        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏õ‡∏¥‡∏î modal ‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô
        function closeReportModal() {
            document.getElementById('reportModal').classList.add('hidden');
            currentSubmissionId = null;
            
            // ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï form
            document.querySelectorAll('input[name="reportReason"]').forEach(input => {
                input.checked = false;
            });
            document.getElementById('reportDetails').value = '';
        }
        
        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡πà‡∏á‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô
        async function submitReport() {
            try {
                const reason = document.querySelector('input[name="reportReason"]:checked');
                if (!reason) {
                    alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏•‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô');
                    return;
                }
                
                const details = document.getElementById('reportDetails').value;
                
                const { error } = await supabase
                    .from('reports')
                    .insert({
                        submission_id: currentSubmissionId,
                        user_id: currentUser.id,
                        reason: reason.value,
                        details: details || null,
                        status: 'pending'
                    });
                
                if (error) throw error;
                
                showToast('‡∏™‡πà‡∏á‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à ‡∏Ç‡∏≠‡∏ö‡∏Ñ‡∏∏‡∏ì‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏ä‡πà‡∏ß‡∏¢‡πÄ‡∏´‡∏•‡∏∑‡∏≠', 'success');
                closeReportModal();
                
            } catch (error) {
                console.error('Error submitting report:', error);
                showToast('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô: ' + error.message, 'error');
            }
        }
        
        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥
        async function updateStats() {
            try {
                // ‡∏î‡∏∂‡∏á‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡∏à‡∏≤‡∏Å‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
                const { data: stats, error } = await supabase
                    .from('gallery_stats')
                    .select('*')
                    .single();
                
                if (error && error.code !== 'PGRST116') throw error;
                
                const statsSummary = document.getElementById('statsSummary');
                
                // ‡∏ñ‡πâ‡∏≤‡∏°‡∏µ‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡∏à‡∏≤‡∏Å‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
                if (stats) {
                    statsSummary.innerHTML = `
                        <div class="bg-white rounded-xl shadow-md p-6">
                            <div class="flex items-center">
                                <div class="w-12 h-12 bg-purple-100 rounded-lg flex items-center justify-center mr-4">
                                    <i class="fas fa-video text-purple-600 text-xl"></i>
                                </div>
                                <div>
                                    <div class="text-2xl font-bold text-gray-800">${stats.total_videos || 0}</div>
                                    <div class="text-sm text-gray-600">‡∏ú‡∏•‡∏á‡∏≤‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</div>
                                </div>
                            </div>
                        </div>
                        <div class="bg-white rounded-xl shadow-md p-6">
                            <div class="flex items-center">
                                <div class="w-12 h-12 bg-blue-100 rounded-lg flex items-center justify-center mr-4">
                                    <i class="fas fa-users text-blue-600 text-xl"></i>
                                </div>
                                <div>
                                    <div class="text-2xl font-bold text-gray-800">${stats.total_creators || 0}</div>
                                    <div class="text-sm text-gray-600">‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏ú‡∏π‡πâ‡∏™‡∏£‡πâ‡∏≤‡∏á</div>
                                </div>
                            </div>
                        </div>
                        <div class="bg-white rounded-xl shadow-md p-6">
                            <div class="flex items-center">
                                <div class="w-12 h-12 bg-green-100 rounded-lg flex items-center justify-center mr-4">
                                    <i class="fas fa-thumbs-up text-green-600 text-xl"></i>
                                </div>
                                <div>
                                    <div class="text-2xl font-bold text-gray-800">${stats.total_likes || 0}</div>
                                    <div class="text-sm text-gray-600">‡∏¢‡∏≠‡∏î‡πÑ‡∏•‡∏Ñ‡πå‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</div>
                                </div>
                            </div>
                        </div>
                        <div class="bg-white rounded-xl shadow-md p-6">
                            <div class="flex items-center">
                                <div class="w-12 h-12 bg-yellow-100 rounded-lg flex items-center justify-center mr-4">
                                    <i class="fas fa-star text-yellow-600 text-xl"></i>
                                </div>
                                <div>
                                    <div class="text-2xl font-bold text-gray-800">${stats.average_rating?.toFixed(1) || '0.0'}</div>
                                    <div class="text-sm text-gray-600">‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢</div>
                                </div>
                            </div>
                        </div>
                    `;
                } else {
                    // ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥ ‡πÉ‡∏´‡πâ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡πÄ‡∏≠‡∏á
                    const { data: submissions, error: submissionsError } = await supabase
                        .from('submissions')
                        .select('*');
                    
                    if (submissionsError) throw submissionsError;
                    
                    const { data: users, error: usersError } = await supabase
                        .from('users')
                        .select('id');
                    
                    if (usersError) throw usersError;
                    
                    const totalVideos = submissions?.length || 0;
                    const totalCreators = new Set(submissions?.map(s => s.user_id)).size || 0;
                    const totalLikes = submissions?.reduce((sum, s) => sum + (s.likes || 0), 0) || 0;
                    const avgRating = submissions?.reduce((sum, s) => sum + (s.average_rating || 0), 0) / totalVideos || 0;
                    
                    statsSummary.innerHTML = `
                        <div class="bg-white rounded-xl shadow-md p-6">
                            <div class="flex items-center">
                                <div class="w-12 h-12 bg-purple-100 rounded-lg flex items-center justify-center mr-4">
                                    <i class="fas fa-video text-purple-600 text-xl"></i>
                                </div>
                                <div>
                                    <div class="text-2xl font-bold text-gray-800">${totalVideos}</div>
                                    <div class="text-sm text-gray-600">‡∏ú‡∏•‡∏á‡∏≤‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</div>
                                </div>
                            </div>
                        </div>
                        <div class="bg-white rounded-xl shadow-md p-6">
                            <div class="flex items-center">
                                <div class="w-12 h-12 bg-blue-100 rounded-lg flex items-center justify-center mr-4">
                                    <i class="fas fa-users text-blue-600 text-xl"></i>
                                </div>
                                <div>
                                    <div class="text-2xl font-bold text-gray-800">${totalCreators}</div>
                                    <div class="text-sm text-gray-600">‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏ú‡∏π‡πâ‡∏™‡∏£‡πâ‡∏≤‡∏á</div>
                                </div>
                            </div>
                        </div>
                        <div class="bg-white rounded-xl shadow-md p-6">
                            <div class="flex items-center">
                                <div class="w-12 h-12 bg-green-100 rounded-lg flex items-center justify-center mr-4">
                                    <i class="fas fa-thumbs-up text-green-600 text-xl"></i>
                                </div>
                                <div>
                                    <div class="text-2xl font-bold text-gray-800">${totalLikes}</div>
                                    <div class="text-sm text-gray-600">‡∏¢‡∏≠‡∏î‡πÑ‡∏•‡∏Ñ‡πå‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</div>
                                </div>
                            </div>
                        </div>
                        <div class="bg-white rounded-xl shadow-md p-6">
                            <div class="flex items-center">
                                <div class="w-12 h-12 bg-yellow-100 rounded-lg flex items-center justify-center mr-4">
                                    <i class="fas fa-star text-yellow-600 text-xl"></i>
                                </div>
                                <div>
                                    <div class="text-2xl font-bold text-gray-800">${avgRating.toFixed(1)}</div>
                                    <div class="text-sm text-gray-600">‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢</div>
                                </div>
                            </div>
                        </div>
                    `;
                }
                
            } catch (error) {
                console.error('Error updating stats:', error);
            }
        }
        
        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ event listeners
        function setupEventListeners() {
            // Filter button
            const applyFiltersBtn = document.getElementById('applyFilters');
            if (applyFiltersBtn) {
                applyFiltersBtn.addEventListener('click', loadSubmissions);
            }
            
            // Rating modal
            const cancelRatingBtn = document.getElementById('cancelRating');
            if (cancelRatingBtn) {
                cancelRatingBtn.addEventListener('click', closeRatingModal);
            }
            
            const submitRatingBtn = document.getElementById('submitRating');
            if (submitRatingBtn) {
                submitRatingBtn.addEventListener('click', submitRating);
            }
            
            // Report modal
            const cancelReportBtn = document.getElementById('cancelReport');
            if (cancelReportBtn) {
                cancelReportBtn.addEventListener('click', closeReportModal);
            }
            
            const submitReportBtn = document.getElementById('submitReport');
            if (submitReportBtn) {
                submitReportBtn.addEventListener('click', submitReport);
            }
            
            // Star rating interaction
            document.querySelectorAll('.star').forEach(star => {
                star.addEventListener('click', function() {
                    const rating = parseInt(this.dataset.rating);
                    
                    // Update all stars
                    document.querySelectorAll('.star').forEach((s, index) => {
                        if (index < rating) {
                            s.classList.remove('far');
                            s.classList.add('fas', 'active');
                        } else {
                            s.classList.remove('fas', 'active');
                            s.classList.add('far');
                        }
                    });
                    
                    const ratingTexts = ['‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏î‡∏≤‡∏ß', '‡πÅ‡∏¢‡πà‡∏°‡∏≤‡∏Å', '‡πÑ‡∏°‡πà‡∏î‡∏µ', '‡∏û‡∏≠‡πÉ‡∏ä‡πâ', '‡∏î‡∏µ', '‡∏î‡∏µ‡∏°‡∏≤‡∏Å'];
                    const ratingText = document.getElementById('ratingText');
                    if (ratingText) {
                        ratingText.textContent = ratingTexts[rating];
                    }
                });
            });
            
            // Modal overlays
            const ratingModal = document.getElementById('ratingModal');
            if (ratingModal) {
                ratingModal.addEventListener('click', (e) => {
                    if (e.target === ratingModal) {
                        closeRatingModal();
                    }
                });
            }
            
            const reportModal = document.getElementById('reportModal');
            if (reportModal) {
                reportModal.addEventListener('click', (e) => {
                    if (e.target === reportModal) {
                        closeReportModal();
                    }
                });
            }
        }
        
        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î
        function showError(message) {
            const galleryGrid = document.getElementById('galleryGrid');
            galleryGrid.innerHTML = `
                <div class="col-span-full text-center py-12">
                    <div class="bg-red-50 border border-red-200 rounded-lg p-8 max-w-md mx-auto">
                        <i class="fas fa-exclamation-triangle text-red-500 text-4xl mb-4"></i>
                        <h3 class="text-xl font-bold text-red-700 mb-2">‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î</h3>
                        <p class="text-gray-600 mb-4">${message}</p>
                        <button onclick="initGallery()" class="bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded-lg">
                            ‡∏•‡∏≠‡∏á‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á
                        </button>
                    </div>
                </div>
            `;
        }
        
        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÅ‡∏™‡∏î‡∏á toast
        function showToast(message, type = 'info') {
            const toast = document.createElement('div');
            toast.className = `fixed top-4 right-4 px-6 py-3 rounded-lg shadow-lg z-50 transition-all duration-300 ${
                type === 'success' ? 'bg-green-100 text-green-800 border border-green-200' :
                type === 'error' ? 'bg-red-100 text-red-800 border border-red-200' :
                'bg-blue-100 text-blue-800 border border-blue-200'
            }`;
            toast.innerHTML = `
                <div class="flex items-center">
                    <i class="fas fa-${type === 'success' ? 'check-circle' : type === 'error' ? 'exclamation-circle' : 'info-circle'} mr-2"></i>
                    <span>${message}</span>
                </div>
            `;
            
            document.body.appendChild(toast);
            
            setTimeout(() => {
                toast.style.opacity = '0';
                toast.style.transform = 'translateY(-20px)';
                setTimeout(() => {
                    toast.remove();
                }, 300);
            }, 3000);
        }
        
        // ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡πÄ‡∏°‡∏∑‡πà‡∏≠ DOM ‡πÇ‡∏´‡∏•‡∏î‡πÄ‡∏™‡∏£‡πá‡∏à
        document.addEventListener('DOMContentLoaded', async () => {
            console.log("üìÑ Gallery page DOM loaded");
            
            // ‡∏£‡∏≠‡πÉ‡∏´‡πâ nav.js ‡πÇ‡∏´‡∏•‡∏î‡πÅ‡∏•‡∏∞‡∏™‡∏£‡πâ‡∏≤‡∏á navigation bar ‡πÄ‡∏™‡∏£‡πá‡∏à‡∏Å‡πà‡∏≠‡∏ô
            await waitForNav();
            
            // ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡πÅ‡∏Å‡∏•‡πÄ‡∏•‡∏≠‡∏£‡∏µ‡πà
            await initGallery();
        });
        
        // ‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡πÉ‡∏ä‡πâ‡∏à‡∏≤‡∏Å HTML ‡πÑ‡∏î‡πâ
        window.handleVote = handleVote;
        window.openRatingModal = openRatingModal;
        window.openReportModal = openReportModal;
        window.loadSubmissions = loadSubmissions;
        window.initGallery = initGallery;
    </script>
    <!-- ‡πÄ‡∏û‡∏¥‡πà‡∏° debug logger script -->
    <script src="js/debug-logger.js"></script>
    
    <script>
        document.addEventListener('DOMContentLoaded', async () => {
            console.log("üîê Checking login status for profile page...");
    
            // ‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÑ‡∏´‡∏°
            console.log("checkCurrentSession:", typeof checkCurrentSession);
            console.log("checkSupabaseSessionAndNav:", typeof checkSupabaseSessionAndNav);
            console.log("Swal:", typeof Swal);
    
            // ‡πÉ‡∏ä‡πâ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏≠‡∏¢‡∏π‡πà‡πÅ‡∏•‡πâ‡∏ß
            await checkSupabaseSessionAndNav();

            // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ß‡πà‡∏≤ session ‡∏°‡∏µ‡∏≠‡∏¢‡∏π‡πà‡∏à‡∏£‡∏¥‡∏á
            const session = await checkCurrentSession();
    
            console.log("Session:", session);
    
            if (!session) {
                console.log("No session found, redirecting to login...");
        
                // ‡∏•‡∏≠‡∏á‡πÉ‡∏ä‡πâ alert ‡πÅ‡∏ö‡∏ö‡∏ò‡∏£‡∏£‡∏°‡∏î‡∏≤‡∏Å‡πà‡∏≠‡∏ô
                alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏•‡πá‡∏≠‡∏Å‡∏≠‡∏¥‡∏ô‡∏Å‡πà‡∏≠‡∏ô‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á‡∏´‡∏ô‡πâ‡∏≤‡∏ô‡∏µ‡πâ');
                window.location.href = 'index.html';
                return;
            }
            
            
            
            // ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô debug logger (‡∏à‡∏∞‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥‡∏≠‡∏¢‡∏π‡πà‡πÅ‡∏•‡πâ‡∏ß)
            // ‡πÅ‡∏ï‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°‡πÑ‡∏î‡πâ
            window.DebugLogger.init({
                autoOpen: false,
                enableConsoleOverride: true
            });
            
            // ‡πÉ‡∏ä‡πâ debug logger
            DebugLogger.info('Missions page loaded');
            
            // ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• missions
            try {
                const supabase = window.supabaseClient || initializeSupabaseClient();
                DebugLogger.debug('Supabase client initialized');
                
                const { data: missions, error } = await supabase
                    .from('missions')
                    .select('*');
                
                if (error) {
                    DebugLogger.error('Failed to fetch missions:', error.message);
                    // handle error
                } else {
                    DebugLogger.success(`Fetched ${missions.length} missions`);
                    // display missions
                }
            } catch (error) {
                DebugLogger.error('Missions page error:', error.message);
            }
        });
    </script>    
</body>
</html>
