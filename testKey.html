<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <title>Test Psychomatrix API</title>
    <style>
        body { font-family: sans-serif; padding: 20px; background: #f0f0f0; }
        .container { background: white; padding: 20px; border-radius: 8px; max-width: 600px; margin: auto; }
        input, button, select { width: 100%; padding: 10px; margin: 10px 0; box-sizing: border-box; }
        button { background: #1a73e8; color: white; border: none; border-radius: 4px; cursor: pointer; }
        button:hover { background: #0d47a1; }
        pre { background: #000; color: #0f0; padding: 10px; border-radius: 4px; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word; }
        .format-hint { font-size: 12px; color: #666; margin-top: -8px; margin-bottom: 10px; }
        .radio-group { display: flex; gap: 20px; margin: 10px 0; }
        .radio-group label { display: flex; align-items: center; gap: 5px; width: auto; }
        .input-group { display: none; }
        .input-group.active { display: block; }
    </style>
</head>
<body>
    <div class="container">
        <h2>üß™ ‡∏ó‡∏î‡∏™‡∏≠‡∏ö Psychomatrix API</h2>
        
        <label>ANON Key:</label>
        <input type="password" id="anonKey" value="sb_publishable_tDw0VvUdJsLrETh25IKCRA_VG-telwP" >

        <div class="format-hint">üîë ‡πÉ‡∏™‡πà‡∏Ñ‡∏µ‡∏¢‡πå‡∏à‡∏≤‡∏Å Supabase ‚Üí Project Settings ‚Üí API</div>

        <label>‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÇ‡∏´‡∏°‡∏î‡∏ó‡∏î‡∏™‡∏≠‡∏ö:</label>
        <div class="radio-group">
            <label>
                <input type="radio" name="testMode" value="lifepath" checked onchange="toggleMode()">
                Life Path (‡∏à‡∏≤‡∏Å‡∏ß‡∏±‡∏ô‡πÄ‡∏Å‡∏¥‡∏î)
            </label>
            <label>
                <input type="radio" name="testMode" value="destiny" onchange="toggleMode()">
                Destiny (‡∏à‡∏≤‡∏Å‡∏ä‡∏∑‡πà‡∏≠)
            </label>
        </div>

        <!-- Life Path Input Group -->
        <div id="lifepathGroup" class="input-group active">
            <label>‡∏ß‡∏±‡∏ô‡πÄ‡∏Å‡∏¥‡∏î‡πÅ‡∏•‡∏∞‡πÄ‡∏ß‡∏•‡∏≤:</label>
            <input type="datetime-local" id="birthDateTime" value="2015-01-28T01:00">
            <div class="format-hint">üìÖ ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏±‡∏ô‡πÅ‡∏•‡∏∞‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏Å‡∏¥‡∏î (‡∏à‡∏∞‡πÅ‡∏õ‡∏•‡∏á‡πÄ‡∏õ‡πá‡∏ô HH:MM DD/MM/YYYY ‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥)</div>
        </div>

        <!-- Destiny Input Group -->
        <div id="destinyGroup" class="input-group">
            <label>‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏ï‡πá‡∏° (‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢/‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©):</label>
            <input type="text" id="fullName" placeholder="‡πÄ‡∏ä‡πà‡∏ô Somchai Jaidee ‡∏´‡∏£‡∏∑‡∏≠ ‡∏™‡∏°‡∏ä‡∏≤‡∏¢ ‡πÉ‡∏à‡∏î‡∏µ">
            <div class="format-hint">üìù ‡πÉ‡∏™‡πà‡∏ä‡∏∑‡πà‡∏≠‡πÅ‡∏•‡∏∞‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•‡πÄ‡∏ï‡πá‡∏°</div>
        </div>
        
        <button onclick="testAPI()">‡πÄ‡∏£‡∏µ‡∏¢‡∏Å API</button>
        
        <h3>‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå:</h3>
        <pre id="result">‡∏£‡∏≠‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏Å API...</pre>
    </div>

    <script>
        function formatDateTimeForAPI(dateTimeLocal) {
            const dt = new Date(dateTimeLocal);
            
            const hours = String(dt.getHours()).padStart(2, '0');
            const minutes = String(dt.getMinutes()).padStart(2, '0');
            const day = String(dt.getDate()).padStart(2, '0');
            const month = String(dt.getMonth() + 1).padStart(2, '0');
            const year = dt.getFullYear();
            
            return `${hours}:${minutes} ${day}/${month}/${year}`;
        }

        function toggleMode() {
            const mode = document.querySelector('input[name="testMode"]:checked').value;
            document.getElementById('lifepathGroup').classList.toggle('active', mode === 'lifepath');
            document.getElementById('destinyGroup').classList.toggle('active', mode === 'destiny');
        }

        async function testAPI() {
            const anonKey = document.getElementById('anonKey').value.trim();
            const mode = document.querySelector('input[name="testMode"]:checked').value;
            
            if (!anonKey) {
                alert('‚ùå ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà ANON KEY ‡∏Å‡πà‡∏≠‡∏ô!');
                return;
            }

            let apiUrl, payload, displayText;

            if (mode === 'lifepath') {
                const birthDateTime = document.getElementById('birthDateTime').value;
                if (!birthDateTime) {
                    alert('‚ùå ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏±‡∏ô‡πÄ‡∏Å‡∏¥‡∏î‡πÅ‡∏•‡∏∞‡πÄ‡∏ß‡∏•‡∏≤!');
                    return;
                }
                const formattedDate = formatDateTimeForAPI(birthDateTime);
                
                apiUrl = 'https://oibubvhuiuurkxhnefsw.supabase.co/functions/v1/psychomatrix-calculate';
                payload = { birth_date: formattedDate };
                displayText = `üì§ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡πà‡∏á Life Path:\n${formattedDate}\n\n‚è≥ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏£‡∏≠‡∏ú‡∏•...`;
            } else {
                const fullName = document.getElementById('fullName').value.trim();
                if (!fullName) {
                    alert('‚ùå ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏ï‡πá‡∏°!');
                    return;
                }
                
                apiUrl = 'https://oibubvhuiuurkxhnefsw.supabase.co/functions/v1/destiny-calculate';
                payload = { full_name: fullName };
                displayText = `üì§ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡πà‡∏á Destiny:\n${fullName}\n\n‚è≥ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏£‡∏≠‡∏ú‡∏•...`;
            }

            document.getElementById('result').textContent = displayText;

            try {
                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${anonKey}`
                    },
                    body: JSON.stringify(payload)
                });

                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                const data = await response.json();
                document.getElementById('result').textContent = JSON.stringify(data, null, 2);
            } catch (error) {
                document.getElementById('result').textContent = `‚ùå Error:\n${error.message}\n\nüí° ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö:\n1. ANON KEY ‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡πÑ‡∏´‡∏°?\n2. Function ‡∏ä‡∏∑‡πà‡∏≠‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡πÑ‡∏´‡∏°?\n3. URL ‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡πÑ‡∏´‡∏°?`;
            }
        }

        // ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏Ñ‡πà‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô
        window.addEventListener('DOMContentLoaded', () => {
            const now = new Date();
            now.setMinutes(0);
//            document.getElementById('birthDateTime').value = now.toISOString().slice(0, 16);

            document.getElementById('fullName').value = 'Thanadej Hwangsutham';
        });
    </script>
</body>
</html>
