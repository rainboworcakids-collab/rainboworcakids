<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<title>üîç ‡∏ó‡∏î‡∏™‡∏≠‡∏ö Search ‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢</title>
<style>
body { font-family: sans-serif; padding: 15px; background: #f0f2f5; }
.container { background: white; padding: 15px; border-radius: 8px; max-width: 500px; margin: auto; }
input, button, pre { width: 100%; padding: 10px; margin: 10px 0; box-sizing: border-box; }
button { background: #1a73e8; color: white; border: none; font-weight: bold; cursor: pointer; }
pre { background: #000; color: #0f0; white-space: pre-wrap; word-wrap: break-word; min-height: 150px; }
.result-item { background: #e8f0fe; padding: 10px; margin: 5px 0; border-radius: 4px; }
.result-item h4 { margin: 0; color: #1a73e8; font-size: 16px; }
.result-item p { margin: 5px 0; font-size: 14px; }
</style>
</head>
<body>
<div class="container">
<h2>üîç ‡∏ó‡∏î‡∏™‡∏≠‡∏ö Search ‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢</h2>

<label>Supabase ANON Key:</label>
<input type="password" id="anonKey" value="sb_publishable_tDw0VvUdJsLrETh25IKCRA_VG-telwP" >
 
<label>‡∏Ñ‡∏≥‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤ (‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢):</label>
<input type="text" id="query" placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏°‡∏ô‡∏∏‡∏©‡∏¢, ‡∏ú‡∏π‡πâ‡∏ô‡∏≥, ‡∏™‡∏±‡∏á‡∏Ñ‡∏°">

<button onclick="search()">üîç ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤</button>

<pre id="result">‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏°‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤</pre>
<div id="resultsList"></div>
</div>

<script>
async function search() {
  const key = document.getElementById('anonKey').value.trim();
  const query = document.getElementById('query').value.trim();

  if (!key || !query) {
    alert('‚ùå ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà ANON Key ‡πÅ‡∏•‡∏∞‡∏Ñ‡∏≥‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤');
    return;
  }

  document.getElementById('result').textContent = `‚è≥ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤ "${query}"...`;
  document.getElementById('resultsList').innerHTML = '';

  try {
    const res = await fetch('https://oibubvhuiuurkxhnefsw.supabase.co/functions/v1/search-numerology', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
        'Authorization': `Bearer ${key}`
      },
      body: JSON.stringify({ query: query, type: 'Destiny' })
    });

    const data = await res.json();

    if (!res.ok) {
      throw new Error(`HTTP ${res.status}: ${JSON.stringify(data)}`);
    }

    document.getElementById('result').textContent = `‚úÖ ‡∏û‡∏ö ${data.count} ‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå`;

    if (data.count === 0) {
      document.getElementById('result').textContent += '\n\n‚ö†Ô∏è ‡πÑ‡∏°‡πà‡πÄ‡∏à‡∏≠‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå ‡∏•‡∏≠‡∏á‡∏Ñ‡∏≥‡∏≠‡∏∑‡πà‡∏ô ‡πÄ‡∏ä‡πà‡∏ô "‡∏°‡∏ô‡∏∏‡∏©‡∏¢", "‡∏ú‡∏π‡πâ‡∏ô‡∏≥"';
    }

    // ‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•
    data.results.forEach(item => {
      const div = document.createElement('div');
      div.className = 'result-item';
      div.innerHTML = `
        <h4>${item.title}</h4>
        <p><strong>‡πÄ‡∏•‡∏Ç:</strong> ${item.root_number}</p>
        <p>${item.summary}</p>
        <p><a href="https://rainboworcakids-collab.github.io${item.html_path}" target="_blank">‡∏î‡∏π‡πÄ‡∏ï‡πá‡∏° ‚Üí</a></p>
      `;
      document.getElementById('resultsList').appendChild(div);
    });

  } catch (err) {
    document.getElementById('result').textContent = `‚ùå Error:\n${err.message}\n\nüí° ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö:\n1. Function ‡∏ä‡∏∑‡πà‡∏≠ search-numerology ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ Active?\n2. ANON Key ‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á?\n3. ‡∏£‡∏±‡∏ô SQL test ‡πÉ‡∏ô‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏à‡∏≠‡πÑ‡∏´‡∏°?`;
  }
}
</script>
</body>
</html>
