<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Psychomatrix Analysis Results</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Psychomatrix Main CSS -->
    <link rel="stylesheet" href="css/PsychomatrixStyle.css">
    <link rel="stylesheet" href="css/result-style.css">
    
    <!-- Favicon -->
    <link rel="icon" href="images/PsychomatixAnalize.png" type="image/png">
    
    <!-- Tailwind config -->
    <script>
    tailwind.config = {
        prefix: 'tw-',
        corePlugins: {
            preflight: false
        }
    }
    </script>

    <style>
        /* ฟอนต์พื้นฐานสำหรับแสดงข้อความ */
        body {
            font-family: 'Arial', sans-serif;
            background-color: #f9fafb;
            padding: 20px;
        }
        
        .result-card {
            background: white;
            border-radius: 10px;
            padding: 20px;
            margin: 15px 0;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            border-left: 5px solid #3b82f6;
        }
        
        .number-badge {
            display: inline-block;
            background: #3b82f6;
            color: white;
            padding: 8px 15px;
            border-radius: 20px;
            font-weight: bold;
            margin: 5px;
            font-size: 1.2rem;
        }
        
        .data-row {
            display: flex;
            justify-content: space-between;
            margin: 10px 0;
            padding: 10px;
            background: #f8fafc;
            border-radius: 5px;
        }
        
        .label {
            font-weight: bold;
            color: #4b5563;
        }
        
        .value {
            color: #1f2937;
            font-weight: bold;
        }
        
        .loading {
            text-align: center;
            padding: 50px;
            color: #6b7280;
        }
        
        .error {
            text-align: center;
            padding: 50px;
            color: #dc2626;
            background: #fef2f2;
            border-radius: 10px;
        }
        
        .section-title {
            color: #1e40af;
            border-bottom: 2px solid #dbeafe;
            padding-bottom: 10px;
            margin-bottom: 20px;
        }
    </style>
</head>
<body class="tw-max-w-4xl tw-mx-h-auto tw-mx-auto tw-bg-gray-100 tw-p-2 tw-mb-1">

    <!-- Version Badge -->
    <div class="version-badge">
        v7.5 (Simple Display)
    </div>
    
    <!-- Tab Buttons -->
    <div class="tw-max-w-4xl tw-mx-h-auto tw-mx-auto tw-rounded tw-shadow">
        <button class="tablink" onclick="switchTab('Main', this)" id="defaultOpen">Main</button>
        <button class="tablink" onclick="switchTab('Explained', this)">Explained</button>
    </div>
    
    <!-- Main Tab -->
    <div id="Main" class="tabcontent printable tw-max-w-4xl tw-mx-h-auto tw-mx-auto tw-bg-white tw-p-6 tw-rounded tw-shadow tw-mt-6 tw-mb-1 tw-overflow-y-auto tw-max-h-[90vh] active">
        <h1 class="tw-text-3xl tw-font-bold tw-text-center tw-mb-2 tw-flex tw-items-center tw-justify-center">
            <img src="images/PsychomatixAnalize.png" alt="Psychomatrix Logo" class="tw-h-18 tw-w-18 tw-mr-4">
            Psychomatrix Analysis - Simple Display
        </h1>
        
        <!-- Loading State -->
        <div id="loadingSection" class="loading">
            <div class="spinner"></div>
            <p class="tw-mt-4 tw-text-gray-600">Loading analysis results...</p>
        </div>
        
        <!-- Error State -->
        <div id="errorSection" class="error tw-hidden">
            <div class="tw-text-red-500 tw-text-4xl tw-mb-4">⚠️</div>
            <h3 class="tw-text-xl tw-font-semibold tw-text-red-600">No analysis data found</h3>
            <p id="errorMessage" class="tw-text-gray-600 tw-mt-2">Please fill in the data on Psychomatrix.html first</p>
            <button onclick="window.location.href='Psychomatrix.html'" class="tw-mt-4 tw-bg-blue-500 hover:tw-bg-blue-600 tw-text-white tw-font-bold tw-py-2 tw-px-6 tw-rounded">
                Return to Input Form
            </button>
        </div>
        
        <!-- Results Container -->
        <div id="resultsContainer" class="tw-hidden">
            <!-- Results will be inserted here -->
        </div>
        
        <div class="tw-mt-4 tw-text-right">
            <span onclick="window.location.href='Psychomatrix.html'" class="tw-text-blue-500 hover:tw-underline tw-cursor-pointer">Return to Input Form</span>
        </div>
    </div>
    
    <!-- Explained Tab -->
    <div id="Explained" class="tabcontent printable tw-max-w-4xl tw-mx-h-auto tw-mx-auto tw-bg-white tw-p-6 tw-rounded tw-shadow tw-mt-6 tw-mb-1 tw-overflow-y-auto tw-max-h-[90vh]">
        <div id="explainedContent" class="explained-content">
            <h2 class="section-title">Explanation</h2>
            <p>This is the simplified version of the result page. The full explanation content would appear here when you click on number buttons in the Main tab.</p>
        </div>
    </div>

    <!-- ตรวจสอบสคริปต์ทั้งหมด -->
    <div class="tw-mt-4 tw-text-center">
        <button onclick="checkData()" class="tw-bg-yellow-500 hover:tw-bg-yellow-600 tw-text-white tw-font-bold tw-py-2 tw-px-4 tw-rounded tw-text-sm">
            Check Session Data
        </button>
    </div>

    <script>
        // ฟังก์ชันสลับแท็บแบบง่าย
        function switchTab(tabName, buttonElement) {
            console.log('Switching to tab:', tabName);
            
            // ซ่อนแท็บทั้งหมด
            const tabContents = document.querySelectorAll('.tabcontent');
            tabContents.forEach(tab => {
                tab.classList.remove('active');
            });
            
            // รีเซ็ตปุ่มแท็บทั้งหมด
            const tabButtons = document.querySelectorAll('.tablink');
            tabButtons.forEach(btn => {
                btn.style.backgroundColor = "";
                btn.style.color = "#aaa";
            });
            
            // แสดงแท็บที่เลือก
            const selectedTab = document.getElementById(tabName);
            if (selectedTab) {
                selectedTab.classList.add('active');
            }
            
            // ตั้งค่าปุ่มที่เลือก
            if (buttonElement) {
                buttonElement.style.backgroundColor = '#f1f2ff';
                buttonElement.style.color = '#00f';
            }
        }
        
        // ฟังก์ชันตรวจสอบข้อมูล
        function checkData() {
            console.log('Checking sessionStorage...');
            const psychomatrixResult = sessionStorage.getItem('psychomatrixResult');
            
            if (psychomatrixResult) {
                try {
                    const data = JSON.parse(psychomatrixResult);
                    alert(`Found data in sessionStorage!\n\nNumber of results: ${data.results ? data.results.length : 1}\n\nCheck console for details.`);
                    console.log('Session data:', data);
                } catch (error) {
                    alert('Error parsing sessionStorage data');
                }
            } else {
                alert('No data found in sessionStorage');
            }
        }
        
        // ฟังก์ชันดึงข้อมูลและแสดงผล
        function loadAndDisplayResults() {
            console.log('Loading and displaying results...');
            
            const loadingSection = document.getElementById('loadingSection');
            const errorSection = document.getElementById('errorSection');
            const resultsContainer = document.getElementById('resultsContainer');
            
            // อ่านข้อมูลจาก sessionStorage
            const resultData = sessionStorage.getItem('psychomatrixResult');
            
            if (!resultData) {
                console.log('No data in sessionStorage');
                setTimeout(() => {
                    if (loadingSection) loadingSection.classList.add('tw-hidden');
                    if (errorSection) errorSection.classList.remove('tw-hidden');
                }, 1000);
                return;
            }
            
            try {
                const data = JSON.parse(resultData);
                console.log('Parsed data:', data);
                
                let html = '';
                
                if (data.results && Array.isArray(data.results)) {
                    console.log(`Found ${data.results.length} results`);
                    
                    data.results.forEach((result, index) => {
                        html += createResultSection(result, index);
                    });
                } else if (data.data) {
                    html += createSingleResultSection(data);
                } else {
                    html += createFallbackDisplay(data);
                }
                
                if (resultsContainer) {
                    resultsContainer.innerHTML = html;
                    resultsContainer.classList.remove('tw-hidden');
                }
                
                setTimeout(() => {
                    if (loadingSection) loadingSection.classList.add('tw-hidden');
                    console.log('Results displayed successfully');
                }, 500);
                
            } catch (error) {
                console.error('Error in loadAndDisplayResults:', error);
                
                setTimeout(() => {
                    if (loadingSection) loadingSection.classList.add('tw-hidden');
                    if (errorSection) {
                        errorSection.classList.remove('tw-hidden');
                        document.getElementById('errorMessage').textContent = `Error: ${error.message}`;
                    }
                }, 1000);
            }
        }
        
        // สร้างส่วนผลลัพธ์
        function createResultSection(result, index) {
            const type = result.type || 'unknown';
            const title = result.title || `Result ${index + 1}`;
            const data = result.data || {};
            
            const destinyNum = data.destiny_number;
            const lifePathNum = data.life_path_number;
            const karmicNum = data.thirdAndFourth?.karmic;
            const lifeLessonNum = data.thirdAndFourth?.lifeLesson;
            
            return `
                <div class="result-card">
                    <h2 class="section-title">${title} (${type})</h2>
                    
                    <div class="data-row">
                        <div class="label">Life Path Number</div>
                        <div class="value">
                            ${lifePathNum ? `<span class="number-badge">${lifePathNum}</span>` : 'N/A'}
                        </div>
                    </div>
                    
                    <div class="data-row">
                        <div class="label">Destiny Number</div>
                        <div class="value">
                            ${destinyNum ? `<span class="number-badge">${destinyNum}</span>` : 'N/A'}
                        </div>
                    </div>
                    
                    <div class="data-row">
                        <div class="label">Karmic Number</div>
                        <div class="value">
                            ${karmicNum ? `<span class="number-badge">${karmicNum}</span>` : 'N/A'}
                        </div>
                    </div>
                    
                    <div class="data-row">
                        <div class="label">Life Lesson Number</div>
                        <div class="value">
                            ${lifeLessonNum ? `<span class="number-badge">${lifeLessonNum}</span>` : 'N/A'}
                        </div>
                    </div>
                    
                    ${data.birth_date ? `
                    <div class="data-row">
                        <div class="label">Birth Date</div>
                        <div class="value">${data.birth_date}</div>
                    </div>
                    ` : ''}
                    
                    ${data.full_name ? `
                    <div class="data-row">
                        <div class="label">Full Name</div>
                        <div class="value">${data.full_name}</div>
                    </div>
                    ` : ''}
                    
                    <div class="tw-mt-6 tw-p-4 tw-bg-blue-50 tw-rounded">
                        <h3 class="tw-font-bold tw-text-blue-800">How to use these numbers</h3>
                        <p class="tw-text-gray-700 tw-mt-2">
                            Each number represents different aspects of your personality and life path. 
                            These are calculated from your birth date and name using Pythagorean numerology.
                        </p>
                    </div>
                </div>
            `;
        }
        
        // สร้างส่วนผลลัพธ์เดี่ยว
        function createSingleResultSection(data) {
            return `
                <div class="result-card">
                    <h2 class="section-title">Analysis Result</h2>
                    <div class="data-row">
                        <div class="label">Result Data</div>
                        <div class="value">Single result mode</div>
                    </div>
                    <pre class="tw-mt-4 tw-p-4 tw-bg-gray-100 tw-rounded tw-text-sm">${JSON.stringify(data.data, null, 2)}</pre>
                </div>
            `;
        }
        
        // สร้างการแสดงผลสำรอง
        function createFallbackDisplay(data) {
            return `
                <div class="result-card">
                    <h2 class="section-title">Raw Analysis Result</h2>
                    <p class="tw-text-gray-600">The data structure is not in the expected format.</p>
                    <pre class="tw-mt-4 tw-p-4 tw-bg-gray-100 tw-rounded tw-text-sm">${JSON.stringify(data, null, 2)}</pre>
                </div>
            `;
        }
        
        // เมื่อหน้าเว็บโหลดเสร็จ
        document.addEventListener('DOMContentLoaded', function() {
            console.log('DOM fully loaded - Simple Display Version');
            
            // เปิดแท็บเริ่มต้น
            setTimeout(() => {
                try {
                    const defaultTab = document.getElementById("defaultOpen");
                    if (defaultTab) {
                        defaultTab.click();
                        console.log('Default tab opened');
                    }
                } catch (error) {
                    console.error('Error opening default tab:', error);
                }
                
                // โหลดและแสดงผลลัพธ์
                setTimeout(() => {
                    loadAndDisplayResults();
                }, 100);
            }, 50);
        });
    </script>
</body>
</html>
