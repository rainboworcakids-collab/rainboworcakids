<!DOCTYPE html>
<html lang="th">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• Grades | Rainbow OrcaKids</title>
    
    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@400;600&display=swap" rel="stylesheet">
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Supabase -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    
    <!-- SweetAlert2 ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Dialog ‡∏™‡∏ß‡∏¢‡∏á‡∏≤‡∏° -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    
</head>

<body class="font-sarabun bg-gray-50">
    <!-- Navigation ‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÇ‡∏î‡∏¢ nav.js -->
    
    <div class="container mx-auto px-4 py-8">

        <!-- Header -->
        <div class="flex flex-col md:flex-row md:items-center justify-between mb-8 gap-4">
            <div>
                <h1 class="text-3xl font-bold text-blue-700 mb-2">
                    <i class="fas fa-graduation-cap mr-3"></i>‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• Grades
                </h1>
                <p class="text-gray-600">‡πÄ‡∏û‡∏¥‡πà‡∏°/‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç/‡∏•‡∏ö ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏ä‡∏±‡πâ‡∏ô‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö (‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏ó‡∏∏‡∏Å‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏®‡∏∂‡∏Å‡∏©‡∏≤)</p>
            </div>
            
            <div class="flex gap-3">
                <!-- ‡∏õ‡∏∏‡πà‡∏°‡∏Å‡∏•‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤ Dashboard -->
                <a href="admin_dashboard.html" 
                   class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-lg flex items-center transition duration-200">
                    <i class="fas fa-tachometer-alt mr-2"></i>Dashboard
                </a>
                
                <!-- ‡∏õ‡∏∏‡πà‡∏°‡πÄ‡∏û‡∏¥‡πà‡∏° Grade ‡πÉ‡∏´‡∏°‡πà -->
                <button onclick="showAddGradeModal()" 
                        class="bg-green-500 hover:bg-green-600 text-white font-bold py-2 px-4 rounded-lg flex items-center transition duration-200">
                    <i class="fas fa-plus mr-2"></i>‡πÄ‡∏û‡∏¥‡πà‡∏° Grade ‡πÉ‡∏´‡∏°‡πà
                </button>
                
                <!-- ‡∏õ‡∏∏‡πà‡∏°‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡∏Å‡∏≤‡∏£‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏£‡∏∞‡∏î‡∏±‡∏ö -->
                <button onclick="showGradeGuide()" 
                        class="bg-purple-500 hover:bg-purple-600 text-white font-bold py-2 px-4 rounded-lg flex items-center transition duration-200">
                    <i class="fas fa-info-circle mr-2"></i>‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥
                </button>
            </div>
        </div>

        <!-- Quick Guide -->
        <div class="bg-blue-50 border border-blue-200 rounded-lg p-4 mb-6">
            <div class="flex items-start">
                <i class="fas fa-lightbulb text-yellow-500 text-xl mt-1 mr-3"></i>
                <div>
                    <h3 class="font-bold text-blue-800 mb-1">‡∏£‡∏∞‡∏ö‡∏ö‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏ä‡∏±‡πâ‡∏ô‡πÅ‡∏ö‡∏ö‡∏Ç‡∏¢‡∏≤‡∏¢ (1-99)</h3>
                    <p class="text-sm text-blue-700">
                        ‡∏£‡∏∞‡∏ö‡∏ö‡πÉ‡∏´‡∏°‡πà‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏ó‡∏∏‡∏Å‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏®‡∏∂‡∏Å‡∏©‡∏≤: 
                        <span class="font-semibold">‡∏≠‡∏ô‡∏∏‡∏ö‡∏≤‡∏• (1-3)</span> | 
                        <span class="font-semibold">‡∏õ‡∏£‡∏∞‡∏ñ‡∏° (4-9)</span> | 
                        <span class="font-semibold">‡∏°‡∏±‡∏ò‡∏¢‡∏°‡∏ï‡πâ‡∏ô (10-12)</span> | 
                        <span class="font-semibold">‡∏°‡∏±‡∏ò‡∏¢‡∏°‡∏õ‡∏•‡∏≤‡∏¢ (13-15)</span> | 
                        <span class="font-semibold">‡∏≠‡∏≤‡∏ä‡∏µ‡∏ß‡∏∞ (16-20)</span> | 
                        <span class="font-semibold">‡∏≠‡∏∏‡∏î‡∏°‡∏®‡∏∂‡∏Å‡∏©‡∏≤ (21-99)</span>
                    </p>
                </div>
            </div>
        </div>

        <!-- Stats Cards -->
        <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-8">
            <div class="bg-white p-4 rounded-lg shadow border border-blue-100">
                <div class="flex items-center">
                    <div class="p-3 rounded-full bg-blue-100 text-blue-600 mr-4">
                        <i class="fas fa-layer-group text-xl"></i>
                    </div>
                    <div>
                        <p class="text-gray-500 text-sm">‡∏£‡∏ß‡∏° Grades</p>
                        <p id="totalGrades" class="text-2xl font-bold">0</p>
                    </div>
                </div>
            </div>
            <div class="bg-white p-4 rounded-lg shadow border border-green-100">
                <div class="flex items-center">
                    <div class="p-3 rounded-full bg-green-100 text-green-600 mr-4">
                        <i class="fas fa-check-circle text-xl"></i>
                    </div>
                    <div>
                        <p class="text-gray-500 text-sm">‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏≠‡∏¢‡∏π‡πà</p>
                        <p id="activeGrades" class="text-2xl font-bold">0</p>
                    </div>
                </div>
            </div>
            <div class="bg-white p-4 rounded-lg shadow border border-yellow-100">
                <div class="flex items-center">
                    <div class="p-3 rounded-full bg-yellow-100 text-yellow-600 mr-4">
                        <i class="fas fa-pause-circle text-xl"></i>
                    </div>
                    <div>
                        <p class="text-gray-500 text-sm">‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô</p>
                        <p id="inactiveGrades" class="text-2xl font-bold">0</p>
                    </div>
                </div>
            </div>
            <div class="bg-white p-4 rounded-lg shadow border border-purple-100">
                <div class="flex items-center">
                    <div class="p-3 rounded-full bg-purple-100 text-purple-600 mr-4">
                        <i class="fas fa-sort-numeric-up text-xl"></i>
                    </div>
                    <div>
                        <p class="text-gray-500 text-sm">‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î</p>
                        <p id="maxGradeLevel" class="text-2xl font-bold">0</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Search and Filter -->
        <div class="bg-white p-4 rounded-lg shadow mb-6">
            <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-4">
                <div class="flex-1">
                    <div class="relative">
                        <input type="text" id="searchInput" 
                               placeholder="‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏ï‡∏≤‡∏°‡∏ä‡∏∑‡πà‡∏≠‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏ä‡∏±‡πâ‡∏ô, ‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢, ‡∏ä‡πà‡∏ß‡∏á‡∏≠‡∏≤‡∏¢‡∏∏..."
                               class="w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                        <i class="fas fa-search absolute left-3 top-3 text-gray-400"></i>
                    </div>
                </div>
                <div class="flex items-center space-x-4">
                    <select id="statusFilter" 
                            class="border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500">
                        <option value="all">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</option>
                        <option value="active">‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏≠‡∏¢‡∏π‡πà</option>
                        <option value="inactive">‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô</option>
                    </select>
                    
                    <select id="educationLevelFilter" 
                            class="border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500">
                        <option value="all">‡∏ó‡∏∏‡∏Å‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏®‡∏∂‡∏Å‡∏©‡∏≤</option>
                        <option value="kindergarten">‡∏≠‡∏ô‡∏∏‡∏ö‡∏≤‡∏• (1-3)</option>
                        <option value="primary">‡∏õ‡∏£‡∏∞‡∏ñ‡∏° (4-9)</option>
                        <option value="middle">‡∏°‡∏±‡∏ò‡∏¢‡∏°‡∏ï‡πâ‡∏ô (10-12)</option>
                        <option value="high">‡∏°‡∏±‡∏ò‡∏¢‡∏°‡∏õ‡∏•‡∏≤‡∏¢ (13-15)</option>
                        <option value="vocational">‡∏≠‡∏≤‡∏ä‡∏µ‡∏ß‡∏∞ (16-20)</option>
                        <option value="higher">‡∏≠‡∏∏‡∏î‡∏°‡∏®‡∏∂‡∏Å‡∏©‡∏≤ (21+)</option>
                    </select>
                    
                    <button onclick="loadGrades()" 
                            class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded-lg flex items-center">
                        <i class="fas fa-sync-alt mr-2"></i>‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä
                    </button>
                </div>
            </div>
        </div>

        <!-- Loading -->
        <div id="loadingStatus" class="p-4 bg-yellow-50 rounded-lg border border-yellow-200 text-gray-700 mb-6">
            <i class="fas fa-spinner fa-spin mr-2"></i>‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• Grades...
        </div>

        <!-- Grades Table -->
        <div class="bg-white rounded-lg shadow overflow-hidden mb-8">
            <div class="overflow-x-auto">
                <table class="min-w-full divide-y divide-gray-200">
                    <thead class="bg-gray-50">
                        <tr>
                            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                <i class="fas fa-sort mr-1"></i>‡∏•‡∏≥‡∏î‡∏±‡∏ö
                            </th>
                            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                <i class="fas fa-hashtag mr-1"></i>‡∏£‡∏∞‡∏î‡∏±‡∏ö
                            </th>
                            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                <i class="fas fa-graduation-cap mr-1"></i>‡∏ä‡∏∑‡πà‡∏≠‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏ä‡∏±‡πâ‡∏ô
                            </th>
                            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                <i class="fas fa-users mr-1"></i>‡∏ä‡πà‡∏ß‡∏á‡∏≠‡∏≤‡∏¢‡∏∏
                            </th>
                            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                <i class="fas fa-tags mr-1"></i>‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó
                            </th>
                            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                <i class="fas fa-toggle-on mr-1"></i>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞
                            </th>
                            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                <i class="fas fa-calendar mr-1"></i>‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÄ‡∏°‡∏∑‡πà‡∏≠
                            </th>
                            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                <i class="fas fa-cogs mr-1"></i>‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£
                            </th>
                        </tr>
                    </thead>
                    <tbody id="gradesTableBody" class="bg-white divide-y divide-gray-200">
                        <!-- Data will be inserted here -->
                    </tbody>
                </table>
            </div>
        </div>

        <!-- No Data Message (hidden by default) -->
        <div id="noDataMessage" class="hidden text-center py-12">
            <i class="fas fa-inbox text-gray-300 text-5xl mb-4"></i>
            <h3 class="text-xl font-semibold text-gray-500 mb-2">‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• Grades</h3>
            <p class="text-gray-400 mb-6">‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏î‡πâ‡∏ß‡∏¢‡∏Å‡∏≤‡∏£‡πÄ‡∏û‡∏¥‡πà‡∏° Grade ‡πÉ‡∏´‡∏°‡πà</p>
            <button onclick="showAddGradeModal()" 
                    class="bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-6 rounded-lg">
                <i class="fas fa-plus mr-2"></i>‡πÄ‡∏û‡∏¥‡πà‡∏° Grade ‡πÉ‡∏´‡∏°‡πà
            </button>
        </div>

        <!-- Back Button -->
        <div class="text-center">
            <a href="admin_dashboard.html" class="inline-flex items-center text-blue-600 hover:text-blue-800 font-semibold">
                <i class="fas fa-arrow-left mr-2"></i>‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡∏´‡∏ô‡πâ‡∏≤ Dashboard
            </a>
        </div>
    </div>

    <!-- Add/Edit Grade Modal (hidden by default) -->
    <div id="gradeModal" class="fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full hidden z-50">
        <div class="relative top-20 mx-auto p-5 border w-full max-w-2xl shadow-lg rounded-md bg-white">
            <div class="flex justify-between items-center pb-3 border-b">
                <h3 id="modalTitle" class="text-2xl font-bold text-gray-700"></h3>
                <button onclick="closeGradeModal()" class="text-gray-400 hover:text-gray-600">
                    <i class="fas fa-times text-2xl"></i>
                </button>
            </div>
            
            <div class="mt-6">
                <form id="gradeForm" onsubmit="saveGrade(event)">
                    <input type="hidden" id="gradeId">
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <!-- Grade Level -->
                        <div>
                            <label class="block text-gray-700 text-sm font-bold mb-2">
                                <i class="fas fa-hashtag mr-1"></i>‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏®‡∏∂‡∏Å‡∏©‡∏≤ *
                            </label>
                            <input type="number" id="gradeLevel" min="0" max="99"
                                   class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                                   placeholder="0-99"
                                   required>
                            <p class="text-xs text-gray-500 mt-1">
                                <span id="levelHint" class="text-blue-600 font-semibold">‡∏Å‡∏£‡∏≠‡∏Å‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç 0-99</span>
                            </p>
                            <button type="button" onclick="autoFillBasedOnLevel()" 
                                    class="mt-2 text-xs bg-blue-100 hover:bg-blue-200 text-blue-700 px-3 py-1 rounded">
                                <i class="fas fa-magic mr-1"></i>‡∏Å‡∏£‡∏≠‡∏Å‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥‡∏ï‡∏≤‡∏°‡∏£‡∏∞‡∏î‡∏±‡∏ö
                            </button>
                        </div>

                        <!-- Display Order -->
                        <div>
                            <label class="block text-gray-700 text-sm font-bold mb-2">
                                <i class="fas fa-sort-numeric-up mr-1"></i>‡∏•‡∏≥‡∏î‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏• *
                            </label>
                            <input type="number" id="displayOrder" min="0" max="999"
                                   class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                                   required>
                            <p class="text-xs text-gray-500 mt-1">‡πÉ‡∏ä‡πâ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏•‡∏≥‡∏î‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•</p>
                        </div>

                        <!-- Thai Name -->
                        <div>
                            <label class="block text-gray-700 text-sm font-bold mb-2">
                                <i class="fas fa-font mr-1"></i>‡∏ä‡∏∑‡πà‡∏≠‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏ä‡∏±‡πâ‡∏ô (‡πÑ‡∏ó‡∏¢) *
                            </label>
                            <input type="text" id="gradeNameTh" 
                                   class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                                   placeholder="‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡∏Å‡∏£‡∏≠‡∏Å‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÉ‡∏™‡πà‡∏£‡∏∞‡∏î‡∏±‡∏ö"
                                   required>
                        </div>

                        <!-- English Name -->
                        <div>
                            <label class="block text-gray-700 text-sm font-bold mb-2">
                                <i class="fas fa-font mr-1"></i>‡∏ä‡∏∑‡πà‡∏≠‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏ä‡∏±‡πâ‡∏ô (‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©)
                            </label>
                            <input type="text" id="gradeNameEn" 
                                   class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                                   placeholder="‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡∏Å‡∏£‡∏≠‡∏Å‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÉ‡∏™‡πà‡∏£‡∏∞‡∏î‡∏±‡∏ö">
                        </div>

                        <!-- Age Group -->
                        <div>
                            <label class="block text-gray-700 text-sm font-bold mb-2">
                                <i class="fas fa-users mr-1"></i>‡∏ä‡πà‡∏ß‡∏á‡∏≠‡∏≤‡∏¢‡∏∏
                            </label>
                            <input type="text" id="ageGroup" 
                                   class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                                   placeholder="‡πÄ‡∏ä‡πà‡∏ô: 3-4 ‡∏õ‡∏µ, 15-16 ‡∏õ‡∏µ">
                        </div>

                        <!-- Education Type -->
                        <div>
                            <label class="block text-gray-700 text-sm font-bold mb-2">
                                <i class="fas fa-tag mr-1"></i>‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏Å‡∏≤‡∏£‡∏®‡∏∂‡∏Å‡∏©‡∏≤
                            </label>
                            <select id="educationType" 
                                    class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                                <option value="kindergarten">‡∏≠‡∏ô‡∏∏‡∏ö‡∏≤‡∏•</option>
                                <option value="primary">‡∏õ‡∏£‡∏∞‡∏ñ‡∏°‡∏®‡∏∂‡∏Å‡∏©‡∏≤</option>
                                <option value="middle">‡∏°‡∏±‡∏ò‡∏¢‡∏°‡∏®‡∏∂‡∏Å‡∏©‡∏≤‡∏ï‡∏≠‡∏ô‡∏ï‡πâ‡∏ô</option>
                                <option value="high">‡∏°‡∏±‡∏ò‡∏¢‡∏°‡∏®‡∏∂‡∏Å‡∏©‡∏≤‡∏ï‡∏≠‡∏ô‡∏õ‡∏•‡∏≤‡∏¢</option>
                                <option value="vocational">‡∏≠‡∏≤‡∏ä‡∏µ‡∏ß‡∏®‡∏∂‡∏Å‡∏©‡∏≤</option>
                                <option value="bachelor">‡∏õ‡∏£‡∏¥‡∏ç‡∏ç‡∏≤‡∏ï‡∏£‡∏µ</option>
                                <option value="master">‡∏õ‡∏£‡∏¥‡∏ç‡∏ç‡∏≤‡πÇ‡∏ó</option>
                                <option value="doctoral">‡∏õ‡∏£‡∏¥‡∏ç‡∏ç‡∏≤‡πÄ‡∏≠‡∏Å</option>
                                <option value="other">‡∏≠‡∏∑‡πà‡∏ô‡πÜ</option>
                            </select>
                        </div>

                        <!-- Description -->
                        <div class="md:col-span-2">
                            <label class="block text-gray-700 text-sm font-bold mb-2">
                                <i class="fas fa-align-left mr-1"></i>‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢
                            </label>
                            <textarea id="description" rows="2"
                                      class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                                      placeholder="‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏Ç‡∏≠‡∏á‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏ä‡∏±‡πâ‡∏ô‡∏ô‡∏µ‡πâ..."></textarea>
                        </div>

                        <!-- Status -->
                        <div>
                            <label class="block text-gray-700 text-sm font-bold mb-2">
                                <i class="fas fa-toggle-on mr-1"></i>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞
                            </label>
                            <div class="flex items-center space-x-4 mt-2">
                                <label class="flex items-center">
                                    <input type="radio" name="isActive" value="true" checked
                                           class="mr-2 text-blue-600 focus:ring-blue-500">
                                    <span class="text-green-600">
                                        <i class="fas fa-check-circle mr-1"></i>‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏≠‡∏¢‡∏π‡πà
                                    </span>
                                </label>
                                <label class="flex items-center">
                                    <input type="radio" name="isActive" value="false"
                                           class="mr-2 text-blue-600 focus:ring-blue-500">
                                    <span class="text-red-600">
                                        <i class="fas fa-times-circle mr-1"></i>‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô
                                    </span>
                                </label>
                            </div>
                        </div>
                    </div>

                    <!-- Education Level Guide -->
                    <div class="mt-6 p-4 bg-blue-50 rounded-lg border border-blue-200">
                        <h4 class="font-bold text-blue-800 mb-2 text-sm">
                            <i class="fas fa-graduation-cap mr-1"></i>‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏®‡∏∂‡∏Å‡∏©‡∏≤:
                        </h4>
                        <div class="grid grid-cols-2 md:grid-cols-3 gap-2 text-xs">
                            <div class="bg-white p-2 rounded border">
                                <span class="font-semibold text-blue-700">0:</span> ‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡∏≠‡∏ô‡∏∏‡∏ö‡∏≤‡∏•
                            </div>
                            <div class="bg-white p-2 rounded border">
                                <span class="font-semibold text-blue-700">1-3:</span> ‡∏≠‡∏ô‡∏∏‡∏ö‡∏≤‡∏• 1-3
                            </div>
                            <div class="bg-white p-2 rounded border">
                                <span class="font-semibold text-blue-700">4-9:</span> ‡∏õ‡∏£‡∏∞‡∏ñ‡∏° 1-6
                            </div>
                            <div class="bg-white p-2 rounded border">
                                <span class="font-semibold text-blue-700">10-12:</span> ‡∏°‡∏±‡∏ò‡∏¢‡∏° 1-3
                            </div>
                            <div class="bg-white p-2 rounded border">
                                <span class="font-semibold text-blue-700">13-15:</span> ‡∏°‡∏±‡∏ò‡∏¢‡∏° 4-6
                            </div>
                            <div class="bg-white p-2 rounded border">
                                <span class="font-semibold text-blue-700">16-20:</span> ‡∏≠‡∏≤‡∏ä‡∏µ‡∏ß‡∏®‡∏∂‡∏Å‡∏©‡∏≤
                            </div>
                            <div class="bg-white p-2 rounded border md:col-span-3">
                                <span class="font-semibold text-blue-700">21+:</span> ‡∏≠‡∏∏‡∏î‡∏°‡∏®‡∏∂‡∏Å‡∏©‡∏≤ (21=‡∏õ.‡∏ï‡∏£‡∏µ‡∏õ‡∏µ1, 25=‡∏õ.‡πÇ‡∏ó‡∏õ‡∏µ1, 27=‡∏õ.‡πÄ‡∏≠‡∏Å)
                            </div>
                        </div>
                    </div>

                    <!-- Form Actions -->
                    <div class="flex justify-end space-x-3 mt-8 pt-4 border-t">
                        <button type="button" onclick="closeGradeModal()"
                                class="px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50">
                            ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å
                        </button>
                        <button type="submit" id="submitButton"
                                class="px-6 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 flex items-center">
                            <i class="fas fa-save mr-2"></i>‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="js/supabase-config.js"></script>
    <script src="js/auth_status_manager.js"></script>
    <script src="js/nav.js"></script>
    
    <!-- Debug Logger -->
    <script src="js/debug-logger.js"></script>
    
    <script>
        document.addEventListener('DOMContentLoaded', async () => {
            console.log("üîê Checking admin permission for this page...");
            
            // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå admin
            const hasPermission = await checkAdminPermission();
            
            if (!hasPermission) {
                // Redirect ‡πÑ‡∏õ‡∏´‡∏ô‡πâ‡∏≤ dashboard
                Swal.fire({
                    icon: 'warning',
                    title: '‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á',
                    text: '‡∏´‡∏ô‡πâ‡∏≤‡∏ô‡∏µ‡πâ‡∏à‡∏≥‡∏Å‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô',
                    confirmButtonText: '‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡∏´‡∏ô‡πâ‡∏≤ Dashboard',
                    allowOutsideClick: false,
                    allowEscapeKey: false
                }).then((result) => {
                    if (result.isConfirmed) {
                        window.location.href = 'admin_dashboard.html';
                    }
                });
                return;
            }
            
            // ‡∏ñ‡πâ‡∏≤‡∏°‡∏µ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå ‡πÉ‡∏´‡πâ‡πÇ‡∏´‡∏•‡∏î‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤‡∏´‡∏•‡∏±‡∏Å
            loadPageContent();
        });

        // ===============================================
        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö admin permission
        // ===============================================
        async function checkAdminPermission() {
            try {
                console.log("üîç Checking admin permission...");
                
                const supabase = await getSupabaseClient();
                if (!supabase) {
                    console.error("‚ùå Supabase client not available");
                    return false;
                }
                
                // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö session
                const { data: { session }, error: sessionError } = await supabase.auth.getSession();
                if (sessionError) {
                    console.error("‚ùå Session error:", sessionError);
                    return false;
                }
                
                if (!session || !session.user) {
                    console.warn("‚ö†Ô∏è No user session found");
                    return false;
                }
                
                console.log("üë§ User logged in:", session.user.email);
                
                // ‡πÉ‡∏ä‡πâ fetchUserProfile
                if (typeof window.fetchUserProfile !== 'function') {
                    console.error("‚ùå fetchUserProfile function not available");
                    return false;
                }
                
                const profile = await window.fetchUserProfile(session.user);
                console.log("üìä User profile:", profile);
                
                if (!profile) {
                    console.error("‚ùå Cannot fetch user profile");
                    return false;
                }
                
                // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤ role ‡πÄ‡∏õ‡πá‡∏ô admin ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
                const isAdmin = profile.role === 'admin' || 
                               profile.role === 'administrator' || 
                               profile.role === 'superadmin';
                
                if (isAdmin) {
                    console.log("‚úÖ Admin permission granted");
                } else {
                    console.warn("‚ö†Ô∏è User is not an admin, role:", profile.role);
                }
                
                return isAdmin;
                
            } catch (error) {
                console.error("‚ùå Error in checkAdminPermission:", error);
                return false;
            }
        }

        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÇ‡∏´‡∏•‡∏î‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤‡∏´‡∏•‡∏±‡∏Å
        async function loadPageContent() {
            console.log("‚úÖ Admin permission verified, loading page content...");
            
            // ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ Event Listeners
            document.getElementById('searchInput').addEventListener('keyup', filterGrades);
            document.getElementById('statusFilter').addEventListener('change', filterGrades);
            document.getElementById('educationLevelFilter').addEventListener('change', filterGrades);
            
            // Auto-fill ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏Å‡∏£‡∏≠‡∏Å‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏®‡∏∂‡∏Å‡∏©‡∏≤
            document.getElementById('gradeLevel').addEventListener('input', handleGradeLevelInput);
            
            // ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• Grades
            await loadGrades();
            
            // Initialize Debug Logger
            initDebugLogger();
        }

        // ===============================================
        // Grades Management JavaScript
        // ===============================================
        let currentGrades = [];
        let isEditMode = false;
        
        // Debug Logger wrapper functions
        function logSuccess(message) {
            if (window.DebugLogger && typeof window.DebugLogger.success === 'function') {
                window.DebugLogger.success(message);
            } else {
                console.log('‚úÖ ' + message);
            }
        }
        
        function logError(message) {
            if (window.DebugLogger && typeof window.DebugLogger.error === 'function') {
                window.DebugLogger.error(message);
            } else {
                console.error('‚ùå ' + message);
            }
        }
        
        function logInfo(message) {
            if (window.DebugLogger && typeof window.DebugLogger.info === 'function') {
                window.DebugLogger.info(message);
            } else {
                console.info('‚ÑπÔ∏è ' + message);
            }
        }
        
        function logWarning(message) {
            if (window.DebugLogger && typeof window.DebugLogger.warning === 'function') {
                window.DebugLogger.warning(message);
            } else {
                console.warn('‚ö†Ô∏è ' + message);
            }
        }
        
        // Fallback Debug Logger
        if (!window.DebugLogger) {
            console.log('‚ö†Ô∏è DebugLogger not found, using fallback logger');
            window.DebugLogger = {
                init: function() { console.log('Fallback DebugLogger initialized'); },
                log: function(msg, type) { 
                    const icon = type === 'success' ? '‚úÖ' : 
                                type === 'error' ? '‚ùå' : 
                                type === 'warning' ? '‚ö†Ô∏è' : 
                                type === 'info' ? 'üîµ' : 'üìù';
                    console.log(`${icon} ${msg}`);
                },
                success: function(msg) { console.log('‚úÖ ' + msg); },
                error: function(msg) { console.error('‚ùå ' + msg); },
                warning: function(msg) { console.warn('‚ö†Ô∏è ' + msg); },
                info: function(msg) { console.info('‚ÑπÔ∏è ' + msg); },
                debug: function(msg) { console.debug('üêõ ' + msg); }
            };
        }
        
        function initDebugLogger() {
            if (window.DebugLogger && typeof window.DebugLogger.init === 'function') {
                try {
                    window.DebugLogger.init();
                    console.log('‚úÖ DebugLogger initialized');
                } catch (e) {
                    console.warn('‚ö†Ô∏è DebugLogger init failed:', e);
                }
            }
        }

        // ===============================================
        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏®‡∏∂‡∏Å‡∏©‡∏≤
        // ===============================================
        
        // Mapping ‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏®‡∏∂‡∏Å‡∏©‡∏≤
        const GRADE_MAPPING = {
            0: { th: "‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡∏≠‡∏ô‡∏∏‡∏ö‡∏≤‡∏•", en: "Pre-Kindergarten", type: "kindergarten", age: "2-3 ‡∏õ‡∏µ" },
            1: { th: "‡∏≠‡∏ô‡∏∏‡∏ö‡∏≤‡∏• 1", en: "Kindergarten 1", type: "kindergarten", age: "3-4 ‡∏õ‡∏µ" },
            2: { th: "‡∏≠‡∏ô‡∏∏‡∏ö‡∏≤‡∏• 2", en: "Kindergarten 2", type: "kindergarten", age: "4-5 ‡∏õ‡∏µ" },
            3: { th: "‡∏≠‡∏ô‡∏∏‡∏ö‡∏≤‡∏• 3", en: "Kindergarten 3", type: "kindergarten", age: "5-6 ‡∏õ‡∏µ" },
            4: { th: "‡∏õ‡∏£‡∏∞‡∏ñ‡∏° 1", en: "Grade 1", type: "primary", age: "6-7 ‡∏õ‡∏µ" },
            5: { th: "‡∏õ‡∏£‡∏∞‡∏ñ‡∏° 2", en: "Grade 2", type: "primary", age: "7-8 ‡∏õ‡∏µ" },
            6: { th: "‡∏õ‡∏£‡∏∞‡∏ñ‡∏° 3", en: "Grade 3", type: "primary", age: "8-9 ‡∏õ‡∏µ" },
            7: { th: "‡∏õ‡∏£‡∏∞‡∏ñ‡∏° 4", en: "Grade 4", type: "primary", age: "9-10 ‡∏õ‡∏µ" },
            8: { th: "‡∏õ‡∏£‡∏∞‡∏ñ‡∏° 5", en: "Grade 5", type: "primary", age: "10-11 ‡∏õ‡∏µ" },
            9: { th: "‡∏õ‡∏£‡∏∞‡∏ñ‡∏° 6", en: "Grade 6", type: "primary", age: "11-12 ‡∏õ‡∏µ" },
            10: { th: "‡∏°‡∏±‡∏ò‡∏¢‡∏° 1", en: "Grade 7", type: "middle", age: "12-13 ‡∏õ‡∏µ" },
            11: { th: "‡∏°‡∏±‡∏ò‡∏¢‡∏° 2", en: "Grade 8", type: "middle", age: "13-14 ‡∏õ‡∏µ" },
            12: { th: "‡∏°‡∏±‡∏ò‡∏¢‡∏° 3", en: "Grade 9", type: "middle", age: "14-15 ‡∏õ‡∏µ" },
            13: { th: "‡∏°‡∏±‡∏ò‡∏¢‡∏° 4", en: "Grade 10", type: "high", age: "15-16 ‡∏õ‡∏µ" },
            14: { th: "‡∏°‡∏±‡∏ò‡∏¢‡∏° 5", en: "Grade 11", type: "high", age: "16-17 ‡∏õ‡∏µ" },
            15: { th: "‡∏°‡∏±‡∏ò‡∏¢‡∏° 6", en: "Grade 12", type: "high", age: "17-18 ‡∏õ‡∏µ" },
            16: { th: "‡∏õ‡∏ß‡∏ä. 1", en: "Vocational 1", type: "vocational", age: "16-17 ‡∏õ‡∏µ" },
            17: { th: "‡∏õ‡∏ß‡∏ä. 2", en: "Vocational 2", type: "vocational", age: "17-18 ‡∏õ‡∏µ" },
            18: { th: "‡∏õ‡∏ß‡∏ä. 3", en: "Vocational 3", type: "vocational", age: "18-19 ‡∏õ‡∏µ" },
            19: { th: "‡∏õ‡∏ß‡∏™. 1", en: "Diploma 1", type: "vocational", age: "19-20 ‡∏õ‡∏µ" },
            20: { th: "‡∏õ‡∏ß‡∏™. 2", en: "Diploma 2", type: "vocational", age: "20-21 ‡∏õ‡∏µ" },
            21: { th: "‡∏õ‡∏£‡∏¥‡∏ç‡∏ç‡∏≤‡∏ï‡∏£‡∏µ ‡∏õ‡∏µ 1", en: "Bachelor Year 1", type: "bachelor", age: "18-19 ‡∏õ‡∏µ" },
            22: { th: "‡∏õ‡∏£‡∏¥‡∏ç‡∏ç‡∏≤‡∏ï‡∏£‡∏µ ‡∏õ‡∏µ 2", en: "Bachelor Year 2", type: "bachelor", age: "19-20 ‡∏õ‡∏µ" },
            23: { th: "‡∏õ‡∏£‡∏¥‡∏ç‡∏ç‡∏≤‡∏ï‡∏£‡∏µ ‡∏õ‡∏µ 3", en: "Bachelor Year 3", type: "bachelor", age: "20-21 ‡∏õ‡∏µ" },
            24: { th: "‡∏õ‡∏£‡∏¥‡∏ç‡∏ç‡∏≤‡∏ï‡∏£‡∏µ ‡∏õ‡∏µ 4", en: "Bachelor Year 4", type: "bachelor", age: "21-22 ‡∏õ‡∏µ" },
            25: { th: "‡∏õ‡∏£‡∏¥‡∏ç‡∏ç‡∏≤‡πÇ‡∏ó ‡∏õ‡∏µ 1", en: "Master Year 1", type: "master", age: "22-23 ‡∏õ‡∏µ" },
            26: { th: "‡∏õ‡∏£‡∏¥‡∏ç‡∏ç‡∏≤‡πÇ‡∏ó ‡∏õ‡∏µ 2", en: "Master Year 2", type: "master", age: "23-24 ‡∏õ‡∏µ" },
            27: { th: "‡∏õ‡∏£‡∏¥‡∏ç‡∏ç‡∏≤‡πÄ‡∏≠‡∏Å", en: "Doctorate", type: "doctoral", age: "24+ ‡∏õ‡∏µ" }
        };
        
        function getGradeInfo(level) {
            level = parseInt(level);
            
            // ‡∏ñ‡πâ‡∏≤‡∏°‡∏µ‡πÉ‡∏ô mapping
            if (GRADE_MAPPING[level]) {
                return GRADE_MAPPING[level];
            }
            
            // ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÉ‡∏ô mapping ‡πÉ‡∏´‡πâ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥
            let thName = "", enName = "", type = "other", age = "";
            
            if (level === 0) {
                thName = "‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡∏≠‡∏ô‡∏∏‡∏ö‡∏≤‡∏•";
                enName = "Pre-Kindergarten";
                type = "kindergarten";
                age = "2-3 ‡∏õ‡∏µ";
            } else if (level <= 3) {
                thName = `‡∏≠‡∏ô‡∏∏‡∏ö‡∏≤‡∏• ${level}`;
                enName = `Kindergarten ${level}`;
                type = "kindergarten";
                age = `${level+2}-${level+3} ‡∏õ‡∏µ`;
            } else if (level <= 9) {
                thName = `‡∏õ‡∏£‡∏∞‡∏ñ‡∏° ${level-3}`;
                enName = `Grade ${level-3}`;
                type = "primary";
                age = `${level+2}-${level+3} ‡∏õ‡∏µ`;
            } else if (level <= 12) {
                thName = `‡∏°‡∏±‡∏ò‡∏¢‡∏° ${level-9}`;
                enName = `Grade ${level-3}`;
                type = "middle";
                age = `${level+2}-${level+3} ‡∏õ‡∏µ`;
            } else if (level <= 15) {
                thName = `‡∏°‡∏±‡∏ò‡∏¢‡∏° ${level-9}`;
                enName = `Grade ${level-3}`;
                type = "high";
                age = `${level+2}-${level+3} ‡∏õ‡∏µ`;
            } else if (level <= 18) {
                thName = `‡∏õ‡∏ß‡∏ä. ${level-15}`;
                enName = `Vocational ${level-15}`;
                type = "vocational";
                age = `${level+1}-${level+2} ‡∏õ‡∏µ`;
            } else if (level <= 20) {
                thName = `‡∏õ‡∏ß‡∏™. ${level-18}`;
                enName = `Diploma ${level-18}`;
                type = "vocational";
                age = `${level+1}-${level+2} ‡∏õ‡∏µ`;
            } else if (level <= 24) {
                thName = `‡∏õ‡∏£‡∏¥‡∏ç‡∏ç‡∏≤‡∏ï‡∏£‡∏µ ‡∏õ‡∏µ ${level-20}`;
                enName = `Bachelor Year ${level-20}`;
                type = "bachelor";
                age = `${level-3}-${level-2} ‡∏õ‡∏µ`;
            } else if (level <= 26) {
                thName = `‡∏õ‡∏£‡∏¥‡∏ç‡∏ç‡∏≤‡πÇ‡∏ó ‡∏õ‡∏µ ${level-24}`;
                enName = `Master Year ${level-24}`;
                type = "master";
                age = `${level-3}-${level-2} ‡∏õ‡∏µ`;
            } else if (level <= 28) {
                thName = `‡∏õ‡∏£‡∏¥‡∏ç‡∏ç‡∏≤‡πÄ‡∏≠‡∏Å ‡∏õ‡∏µ ${level-26}`;
                enName = `Doctorate Year ${level-26}`;
                type = "doctoral";
                age = `${level-3}-${level+2} ‡∏õ‡∏µ`;
            } else {
                thName = `‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏®‡∏∂‡∏Å‡∏©‡∏≤ ${level}`;
                enName = `Education Level ${level}`;
                type = "other";
                age = `${level+10}-${level+15} ‡∏õ‡∏µ`;
            }
            
            return { th: thName, en: enName, type: type, age: age };
        }
        
        function getEducationTypeLabel(type) {
            const labels = {
                "kindergarten": "‡∏≠‡∏ô‡∏∏‡∏ö‡∏≤‡∏•",
                "primary": "‡∏õ‡∏£‡∏∞‡∏ñ‡∏°",
                "middle": "‡∏°.‡∏ï‡πâ‡∏ô",
                "high": "‡∏°.‡∏õ‡∏•‡∏≤‡∏¢",
                "vocational": "‡∏≠‡∏≤‡∏ä‡∏µ‡∏ß‡∏∞",
                "bachelor": "‡∏õ.‡∏ï‡∏£‡∏µ",
                "master": "‡∏õ.‡πÇ‡∏ó",
                "doctoral": "‡∏õ.‡πÄ‡∏≠‡∏Å",
                "other": "‡∏≠‡∏∑‡πà‡∏ô‡πÜ"
            };
            return labels[type] || type;
        }
        
        function getEducationTypeColor(type) {
            const colors = {
                "kindergarten": "bg-yellow-100 text-yellow-800 border-yellow-200",
                "primary": "bg-green-100 text-green-800 border-green-200",
                "middle": "bg-blue-100 text-blue-800 border-blue-200",
                "high": "bg-purple-100 text-purple-800 border-purple-200",
                "vocational": "bg-orange-100 text-orange-800 border-orange-200",
                "bachelor": "bg-red-100 text-red-800 border-red-200",
                "master": "bg-pink-100 text-pink-800 border-pink-200",
                "doctoral": "bg-indigo-100 text-indigo-800 border-indigo-200",
                "other": "bg-gray-100 text-gray-800 border-gray-200"
            };
            return colors[type] || "bg-gray-100 text-gray-800 border-gray-200";
        }
        
        function handleGradeLevelInput() {
            const level = document.getElementById('gradeLevel').value;
            if (level === '' || level < 0 || level > 99) return;
            
            const info = getGradeInfo(level);
            
            // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï hint
            const hintElement = document.getElementById('levelHint');
            hintElement.textContent = `${info.th} (${info.age})`;
            
            // ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà edit mode ‡∏´‡∏£‡∏∑‡∏≠‡πÄ‡∏õ‡πá‡∏ô add mode ‡πÉ‡∏´‡πâ auto-fill
            if (!isEditMode || document.getElementById('gradeId').value === '') {
                document.getElementById('gradeNameTh').value = info.th;
                document.getElementById('gradeNameEn').value = info.en;
                document.getElementById('ageGroup').value = info.age;
                document.getElementById('educationType').value = info.type;
            }
        }
        
        function autoFillBasedOnLevel() {
            const level = document.getElementById('gradeLevel').value;
            if (level === '' || level < 0 || level > 99) {
                Swal.fire({
                    icon: 'warning',
                    title: '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏®‡∏∂‡∏Å‡∏©‡∏≤',
                    text: '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏®‡∏∂‡∏Å‡∏©‡∏≤ 0-99 ‡∏Å‡πà‡∏≠‡∏ô',
                    confirmButtonText: '‡∏ï‡∏Å‡∏•‡∏á'
                });
                return;
            }
            
            const info = getGradeInfo(level);
            document.getElementById('gradeNameTh').value = info.th;
            document.getElementById('gradeNameEn').value = info.en;
            document.getElementById('ageGroup').value = info.age;
            document.getElementById('educationType').value = info.type;
            
            // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï hint
            const hintElement = document.getElementById('levelHint');
            hintElement.textContent = `${info.th} (${info.age})`;
            
            logInfo(`‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏£‡∏∞‡∏î‡∏±‡∏ö ${level}: ${info.th}`);
        }
        
        function showGradeGuide() {
            Swal.fire({
                title: '‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡∏Å‡∏≤‡∏£‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏®‡∏∂‡∏Å‡∏©‡∏≤',
                html: `
                    <div class="text-left">
                        <h4 class="font-bold text-blue-700 mb-2">‡∏£‡∏∞‡∏ö‡∏ö‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏ä‡∏±‡πâ‡∏ô‡πÅ‡∏ö‡∏ö‡∏Ç‡∏¢‡∏≤‡∏¢ (0-99):</h4>
                        <table class="w-full text-sm">
                            <thead class="bg-gray-100">
                                <tr>
                                    <th class="p-2 border">‡∏£‡∏∞‡∏î‡∏±‡∏ö</th>
                                    <th class="p-2 border">‡∏ä‡∏∑‡πà‡∏≠‡πÑ‡∏ó‡∏¢</th>
                                    <th class="p-2 border">‡∏ä‡πà‡∏ß‡∏á‡∏≠‡∏≤‡∏¢‡∏∏</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr class="bg-yellow-50"><td class="p-2 border font-bold" colspan="3">‡∏≠‡∏ô‡∏∏‡∏ö‡∏≤‡∏•</td></tr>
                                <tr><td class="p-2 border">0</td><td class="p-2 border">‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡∏≠‡∏ô‡∏∏‡∏ö‡∏≤‡∏•</td><td class="p-2 border">2-3 ‡∏õ‡∏µ</td></tr>
                                <tr><td class="p-2 border">1-3</td><td class="p-2 border">‡∏≠‡∏ô‡∏∏‡∏ö‡∏≤‡∏• 1-3</td><td class="p-2 border">3-6 ‡∏õ‡∏µ</td></tr>
                                
                                <tr class="bg-green-50"><td class="p-2 border font-bold" colspan="3">‡∏õ‡∏£‡∏∞‡∏ñ‡∏°‡∏®‡∏∂‡∏Å‡∏©‡∏≤</td></tr>
                                <tr><td class="p-2 border">4-9</td><td class="p-2 border">‡∏õ‡∏£‡∏∞‡∏ñ‡∏° 1-6</td><td class="p-2 border">6-12 ‡∏õ‡∏µ</td></tr>
                                
                                <tr class="bg-blue-50"><td class="p-2 border font-bold" colspan="3">‡∏°‡∏±‡∏ò‡∏¢‡∏°‡∏ï‡πâ‡∏ô</td></tr>
                                <tr><td class="p-2 border">10-12</td><td class="p-2 border">‡∏°‡∏±‡∏ò‡∏¢‡∏° 1-3</td><td class="p-2 border">12-15 ‡∏õ‡∏µ</td></tr>
                                
                                <tr class="bg-purple-50"><td class="p-2 border font-bold" colspan="3">‡∏°‡∏±‡∏ò‡∏¢‡∏°‡∏õ‡∏•‡∏≤‡∏¢</td></tr>
                                <tr><td class="p-2 border">13-15</td><td class="p-2 border">‡∏°‡∏±‡∏ò‡∏¢‡∏° 4-6</td><td class="p-2 border">15-18 ‡∏õ‡∏µ</td></tr>
                                
                                <tr class="bg-orange-50"><td class="p-2 border font-bold" colspan="3">‡∏≠‡∏≤‡∏ä‡∏µ‡∏ß‡∏®‡∏∂‡∏Å‡∏©‡∏≤</td></tr>
                                <tr><td class="p-2 border">16-18</td><td class="p-2 border">‡∏õ‡∏ß‡∏ä. 1-3</td><td class="p-2 border">16-19 ‡∏õ‡∏µ</td></tr>
                                <tr><td class="p-2 border">19-20</td><td class="p-2 border">‡∏õ‡∏ß‡∏™. 1-2</td><td class="p-2 border">19-21 ‡∏õ‡∏µ</td></tr>
                                
                                <tr class="bg-red-50"><td class="p-2 border font-bold" colspan="3">‡∏≠‡∏∏‡∏î‡∏°‡∏®‡∏∂‡∏Å‡∏©‡∏≤</td></tr>
                                <tr><td class="p-2 border">21-24</td><td class="p-2 border">‡∏õ‡∏£‡∏¥‡∏ç‡∏ç‡∏≤‡∏ï‡∏£‡∏µ ‡∏õ‡∏µ 1-4</td><td class="p-2 border">18-22 ‡∏õ‡∏µ</td></tr>
                                <tr><td class="p-2 border">25-26</td><td class="p-2 border">‡∏õ‡∏£‡∏¥‡∏ç‡∏ç‡∏≤‡πÇ‡∏ó ‡∏õ‡∏µ 1-2</td><td class="p-2 border">22-24 ‡∏õ‡∏µ</td></tr>
                                <tr><td class="p-2 border">27+</td><td class="p-2 border">‡∏õ‡∏£‡∏¥‡∏ç‡∏ç‡∏≤‡πÄ‡∏≠‡∏Å</td><td class="p-2 border">24+ ‡∏õ‡∏µ</td></tr>
                            </tbody>
                        </table>
                        <p class="mt-3 text-sm text-gray-600">
                            <i class="fas fa-lightbulb mr-1"></i>
                            <strong>‡πÄ‡∏Ñ‡∏•‡πá‡∏î‡∏•‡∏±‡∏ö:</strong> ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏Å‡∏£‡∏≠‡∏Å‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç‡∏£‡∏∞‡∏î‡∏±‡∏ö‡πÅ‡∏•‡πâ‡∏ß ‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏° "‡∏Å‡∏£‡∏≠‡∏Å‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥‡∏ï‡∏≤‡∏°‡∏£‡∏∞‡∏î‡∏±‡∏ö" ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏ï‡∏¥‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥
                        </p>
                    </div>
                `,
                width: 700,
                confirmButtonText: '‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏à‡πÅ‡∏•‡πâ‡∏ß'
            });
        }

        // ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• Grades ‡∏à‡∏≤‡∏Å Supabase
        async function loadGrades() {
            const loadingStatus = document.getElementById('loadingStatus');
            const noDataMessage = document.getElementById('noDataMessage');
            const tableBody = document.getElementById('gradesTableBody');
            
            loadingStatus.classList.remove('hidden');
            tableBody.innerHTML = '';
            
            try {
                const supabase = await getSupabaseClient();
                if (!supabase) {
                    showError('‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏Å‡∏±‡∏ö‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏î‡πâ');
                    return;
                }
                
                // ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• grades ‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏•‡∏≥‡∏î‡∏±‡∏ö‡∏ï‡∏≤‡∏° display_order
                const { data: grades, error } = await supabase
                    .from('grades')
                    .select('*')
                    .order('display_order', { ascending: true });
                
                if (error) throw error;
                
                currentGrades = grades || [];
                
                // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥
                updateStats(currentGrades);
                
                // ‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô‡∏ï‡∏≤‡∏£‡∏≤‡∏á
                if (currentGrades.length > 0) {
                    renderGradesTable(currentGrades);
                    noDataMessage.classList.add('hidden');
                } else {
                    tableBody.innerHTML = '';
                    noDataMessage.classList.remove('hidden');
                }
                
                loadingStatus.classList.add('hidden');
                
                logSuccess(`‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• Grades ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à: ${currentGrades.length} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£`);
                
            } catch (error) {
                loadingStatus.classList.add('hidden');
                showError('‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• Grades ‡πÑ‡∏î‡πâ: ' + error.message);
                logError('Error loading grades: ' + error.message);
            }
        }

        // ‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô‡∏ï‡∏≤‡∏£‡∏≤‡∏á
        function renderGradesTable(grades) {
            const tableBody = document.getElementById('gradesTableBody');
            tableBody.innerHTML = '';
            
            grades.forEach((grade, index) => {
                const row = document.createElement('tr');
                row.className = 'hover:bg-gray-50 transition-colors';
                
                // ‡∏ü‡∏≠‡∏£‡πå‡πÅ‡∏°‡∏ï‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà
                const createdDate = new Date(grade.created_at).toLocaleDateString('th-TH', {
                    year: 'numeric',
                    month: 'short',
                    day: 'numeric'
                });
                
                // ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏Å‡∏≤‡∏£‡∏®‡∏∂‡∏Å‡∏©‡∏≤
                const gradeInfo = getGradeInfo(grade.grade_level);
                const typeLabel = getEducationTypeLabel(gradeInfo.type);
                const typeColor = getEducationTypeColor(gradeInfo.type);
                
                // ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏™‡∏µ badge ‡∏ï‡∏≤‡∏°‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏®‡∏∂‡∏Å‡∏©‡∏≤
                let levelColor = 'bg-blue-100 text-blue-800';
                if (grade.grade_level <= 3) {
                    levelColor = 'bg-yellow-100 text-yellow-800';
                } else if (grade.grade_level <= 9) {
                    levelColor = 'bg-green-100 text-green-800';
                } else if (grade.grade_level <= 12) {
                    levelColor = 'bg-blue-100 text-blue-800';
                } else if (grade.grade_level <= 15) {
                    levelColor = 'bg-purple-100 text-purple-800';
                } else if (grade.grade_level <= 20) {
                    levelColor = 'bg-orange-100 text-orange-800';
                } else {
                    levelColor = 'bg-red-100 text-red-800';
                }
                
                row.innerHTML = `
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900 font-medium">
                        ${grade.display_order}
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        <span class="px-3 py-1 text-sm font-semibold rounded-full ${levelColor}">
                            Lv. ${grade.grade_level}
                        </span>
                    </td>
                    <td class="px-6 py-4">
                        <div class="text-sm font-medium text-gray-900">${grade.grade_name_th}</div>
                        <div class="text-sm text-gray-500">${grade.grade_name_en || '-'}</div>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                        ${grade.age_group || gradeInfo.age || '-'}
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        <span class="px-2 py-1 text-xs font-semibold rounded-full border ${typeColor}">
                            ${typeLabel}
                        </span>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        <span class="px-2 py-1 text-xs font-semibold rounded-full ${grade.is_active ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'}">
                            ${grade.is_active ? '‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô' : '‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô'}
                        </span>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                        <i class="far fa-clock mr-1"></i>${createdDate}
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                        <button onclick="editGrade('${grade.grade_id}')" 
                                class="text-blue-600 hover:text-blue-900 mr-3" title="‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button onclick="deleteGrade('${grade.grade_id}', '${grade.grade_name_th}')" 
                                class="text-red-600 hover:text-red-900" title="‡∏•‡∏ö">
                            <i class="fas fa-trash"></i>
                        </button>
                    </td>
                `;
                
                tableBody.appendChild(row);
            });
        }

        // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥
        function updateStats(grades) {
            const total = grades.length;
            const active = grades.filter(g => g.is_active).length;
            const inactive = total - active;
            const maxGradeLevel = grades.length > 0 ? Math.max(...grades.map(g => g.grade_level)) : 0;
            
            document.getElementById('totalGrades').textContent = total;
            document.getElementById('activeGrades').textContent = active;
            document.getElementById('inactiveGrades').textContent = inactive;
            document.getElementById('maxGradeLevel').textContent = maxGradeLevel;
        }

        // ‡∏Å‡∏£‡∏≠‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• Grades
        function filterGrades() {
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            const statusFilter = document.getElementById('statusFilter').value;
            const educationFilter = document.getElementById('educationLevelFilter').value;
            
            let filtered = currentGrades;
            
            // ‡∏Å‡∏£‡∏≠‡∏á‡∏ï‡∏≤‡∏°‡∏Ñ‡∏≥‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤
            if (searchTerm) {
                filtered = filtered.filter(grade => 
                    grade.grade_level.toString().includes(searchTerm) ||
                    grade.grade_name_th.toLowerCase().includes(searchTerm) ||
                    grade.grade_name_en?.toLowerCase().includes(searchTerm) ||
                    grade.age_group?.toLowerCase().includes(searchTerm) ||
                    grade.description?.toLowerCase().includes(searchTerm)
                );
            }
            
            // ‡∏Å‡∏£‡∏≠‡∏á‡∏ï‡∏≤‡∏°‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞
            if (statusFilter !== 'all') {
                filtered = filtered.filter(grade => 
                    statusFilter === 'active' ? grade.is_active : !grade.is_active
                );
            }
            
            // ‡∏Å‡∏£‡∏≠‡∏á‡∏ï‡∏≤‡∏°‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏®‡∏∂‡∏Å‡∏©‡∏≤
            if (educationFilter !== 'all') {
                filtered = filtered.filter(grade => {
                    const gradeInfo = getGradeInfo(grade.grade_level);
                    
                    switch(educationFilter) {
                        case 'kindergarten': return grade.grade_level <= 3;
                        case 'primary': return grade.grade_level >= 4 && grade.grade_level <= 9;
                        case 'middle': return grade.grade_level >= 10 && grade.grade_level <= 12;
                        case 'high': return grade.grade_level >= 13 && grade.grade_level <= 15;
                        case 'vocational': return grade.grade_level >= 16 && grade.grade_level <= 20;
                        case 'higher': return grade.grade_level >= 21;
                        default: return true;
                    }
                });
            }
            
            renderGradesTable(filtered);
        }

        // ‡πÅ‡∏™‡∏î‡∏á Modal ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÄ‡∏û‡∏¥‡πà‡∏° Grade
        function showAddGradeModal() {
            isEditMode = false;
            document.getElementById('modalTitle').textContent = '‡πÄ‡∏û‡∏¥‡πà‡∏° Grade ‡πÉ‡∏´‡∏°‡πà';
            document.getElementById('submitButton').innerHTML = '<i class="fas fa-save mr-2"></i>‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•';
            
            // ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏ü‡∏≠‡∏£‡πå‡∏°
            document.getElementById('gradeForm').reset();
            document.getElementById('gradeId').value = '';
            document.getElementById('levelHint').textContent = '‡∏Å‡∏£‡∏≠‡∏Å‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç 0-99';
            
            // ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ display order ‡∏ñ‡∏±‡∏î‡πÑ‡∏õ
            const maxOrder = currentGrades.length > 0 ? Math.max(...currentGrades.map(g => g.display_order)) : 0;
            document.getElementById('displayOrder').value = maxOrder + 1;
            
            // ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ grade level ‡∏ñ‡∏±‡∏î‡πÑ‡∏õ (‡πÑ‡∏°‡πà‡∏ã‡πâ‡∏≥‡∏Å‡∏±‡∏ö‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏≠‡∏¢‡∏π‡πà)
            const existingLevels = currentGrades.map(g => g.grade_level);
            let nextLevel = 1;
            while (existingLevels.includes(nextLevel)) {
                nextLevel++;
                if (nextLevel > 99) {
                    nextLevel = 99;
                    break;
                }
            }
            document.getElementById('gradeLevel').value = nextLevel;
            
            // Auto-suggest ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
            const info = getGradeInfo(nextLevel);
            document.getElementById('gradeNameTh').value = info.th;
            document.getElementById('gradeNameEn').value = info.en;
            document.getElementById('ageGroup').value = info.age;
            document.getElementById('educationType').value = info.type;
            
            // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï hint
            document.getElementById('levelHint').textContent = `${info.th} (${info.age})`;
            
            // ‡πÅ‡∏™‡∏î‡∏á Modal
            document.getElementById('gradeModal').classList.remove('hidden');
        }

        // ‡πÅ‡∏™‡∏î‡∏á Modal ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç Grade
        async function editGrade(gradeId) {
            const grade = currentGrades.find(g => g.grade_id === gradeId);
            if (!grade) {
                showError('‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• Grade ‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç');
                return;
            }
            
            isEditMode = true;
            document.getElementById('modalTitle').textContent = '‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç Grade';
            document.getElementById('submitButton').innerHTML = '<i class="fas fa-save mr-2"></i>‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•';
            
            // ‡πÄ‡∏ï‡∏¥‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡∏á‡πÉ‡∏ô‡∏ü‡∏≠‡∏£‡πå‡∏°
            document.getElementById('gradeId').value = grade.grade_id;
            document.getElementById('gradeLevel').value = grade.grade_level;
            document.getElementById('gradeLevel').readOnly = true; // ‡πÑ‡∏°‡πà‡πÉ‡∏´‡πâ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç grade level ‡πÉ‡∏ô‡πÇ‡∏´‡∏°‡∏î‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç
            document.getElementById('displayOrder').value = grade.display_order;
            document.getElementById('gradeNameTh').value = grade.grade_name_th;
            document.getElementById('gradeNameEn').value = grade.grade_name_en || '';
            document.getElementById('ageGroup').value = grade.age_group || '';
            document.getElementById('description').value = grade.description || '';
            
            // ‡∏Å‡∏≥‡∏´‡∏ô‡∏î education type ‡∏ï‡∏≤‡∏°‡∏£‡∏∞‡∏î‡∏±‡∏ö
            const gradeInfo = getGradeInfo(grade.grade_level);
            document.getElementById('educationType').value = gradeInfo.type;
            
            // ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞
            const activeRadio = document.querySelector(`input[name="isActive"][value="${grade.is_active}"]`);
            if (activeRadio) {
                activeRadio.checked = true;
            }
            
            // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï hint
            const hintElement = document.getElementById('levelHint');
            hintElement.textContent = `${grade.grade_name_th} (${grade.age_group || gradeInfo.age})`;
            
            // ‡πÅ‡∏™‡∏î‡∏á Modal
            document.getElementById('gradeModal').classList.remove('hidden');
        }

        // ‡∏õ‡∏¥‡∏î Modal
        function closeGradeModal() {
            document.getElementById('gradeModal').classList.add('hidden');
            document.getElementById('gradeLevel').readOnly = false; // ‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏´‡πâ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç grade level ‡πÉ‡∏´‡∏°‡πà
        }

        // ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• Grade
        async function saveGrade(event) {
            event.preventDefault();
            
            try {
                const supabase = await getSupabaseClient();
                if (!supabase) {
                    showError('‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏Å‡∏±‡∏ö‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏î‡πâ');
                    return;
                }
                
                const gradeLevel = parseInt(document.getElementById('gradeLevel').value);
                if (gradeLevel < 0 || gradeLevel > 99) {
                    showError('‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏®‡∏∂‡∏Å‡∏©‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡∏≠‡∏¢‡∏π‡πà‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á 0-99');
                    return;
                }
                
                const gradeData = {
                    grade_level: gradeLevel,
                    display_order: parseInt(document.getElementById('displayOrder').value),
                    grade_name_th: document.getElementById('gradeNameTh').value.trim(),
                    grade_name_en: document.getElementById('gradeNameEn').value.trim() || null,
                    age_group: document.getElementById('ageGroup').value.trim() || null,
                    description: document.getElementById('description').value.trim() || null,
                    is_active: document.querySelector('input[name="isActive"]:checked').value === 'true'
                };
                
                const gradeId = document.getElementById('gradeId').value;
                
                let result;
                if (isEditMode && gradeId) {
                    // ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
                    const { data, error } = await supabase
                        .from('grades')
                        .update({
                            ...gradeData,
                            updated_at: new Date().toISOString()
                        })
                        .eq('grade_id', gradeId)
                        .select();
                    
                    if (error) throw error;
                    result = data[0];
                    
                    logSuccess(`‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï Grade ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à: ${gradeData.grade_name_th}`);
                    
                } else {
                    // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡∏°‡πà
                    const { data, error } = await supabase
                        .from('grades')
                        .insert([gradeData])
                        .select();
                    
                    if (error) throw error;
                    result = data[0];
                    
                    logSuccess(`‡πÄ‡∏û‡∏¥‡πà‡∏° Grade ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à: ${gradeData.grade_name_th}`);
                }
                
                // ‡∏õ‡∏¥‡∏î Modal ‡πÅ‡∏•‡∏∞‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
                closeGradeModal();
                await loadGrades();
                
                // ‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à
                Swal.fire({
                    icon: 'success',
                    title: '‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!',
                    text: `‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• Grade "${gradeData.grade_name_th}" ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à`,
                    timer: 2000,
                    showConfirmButton: false
                });
                
            } catch (error) {
                console.error('Error saving grade:', error);
                
                if (error.code === '23505') { // Unique violation
                    showError('‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏ä‡∏±‡πâ‡∏ô‡∏ô‡∏µ‡πâ‡∏°‡∏µ‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö‡πÅ‡∏•‡πâ‡∏ß ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏ä‡πâ‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏ä‡∏±‡πâ‡∏ô‡∏≠‡∏∑‡πà‡∏ô');
                } else {
                    showError('‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à: ' + error.message);
                }
                
                logError('Error saving grade: ' + error.message);
            }
        }

        // ‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• Grade
        async function deleteGrade(gradeId, gradeName) {
            // ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡∏ö
            const result = await Swal.fire({
                title: '‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡∏ö',
                text: `‡∏Ñ‡∏∏‡∏ì‡πÅ‡∏ô‡πà‡πÉ‡∏à‡∏ß‡πà‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö Grade "${gradeName}" ‡πÉ‡∏ä‡πà‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?`,
                icon: 'warning',
                showCancelButton: true,
                confirmButtonColor: '#d33',
                cancelButtonColor: '#3085d6',
                confirmButtonText: '‡πÉ‡∏ä‡πà, ‡∏•‡∏ö‡πÄ‡∏•‡∏¢!',
                cancelButtonText: '‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å'
            });
            
            if (!result.isConfirmed) return;
            
            try {
                const supabase = await getSupabaseClient();
                if (!supabase) {
                    showError('‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏Å‡∏±‡∏ö‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏î‡πâ');
                    return;
                }
                
                const { error } = await supabase
                    .from('grades')
                    .delete()
                    .eq('grade_id', gradeId);
                
                if (error) throw error;
                
                logSuccess(`‡∏•‡∏ö Grade ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à: ${gradeName}`);
                
                // ‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
                await loadGrades();
                
                // ‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à
                Swal.fire({
                    icon: 'success',
                    title: '‡∏•‡∏ö‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!',
                    text: `‡∏•‡∏ö Grade "${gradeName}" ‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö‡πÅ‡∏•‡πâ‡∏ß`,
                    timer: 2000,
                    showConfirmButton: false
                });
                
            } catch (error) {
                console.error('Error deleting grade:', error);
                
                // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤ Grade ‡∏ô‡∏µ‡πâ‡∏ñ‡∏π‡∏Å‡πÉ‡∏ä‡πâ‡∏≠‡∏¢‡∏π‡πà‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
                if (error.code === '23503') { // Foreign key violation
                    showError('‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏•‡∏ö Grade ‡∏ô‡∏µ‡πâ‡πÑ‡∏î‡πâ ‡πÄ‡∏ô‡∏∑‡πà‡∏≠‡∏á‡∏à‡∏≤‡∏Å‡∏ñ‡∏π‡∏Å‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö‡πÅ‡∏•‡πâ‡∏ß');
                } else {
                    showError('‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à: ' + error.message);
                }
                
                logError('Error deleting grade: ' + error.message);
            }
        }

        // ‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô
        function showError(message) {
            Swal.fire({
                icon: 'error',
                title: '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î',
                text: message,
                confirmButtonText: '‡∏ï‡∏Å‡∏•‡∏á'
            });
        }
    </script>
    
    <style>
        /* Custom styles */
        .hover-scale {
            transition: transform 0.2s ease-in-out;
        }
        .hover-scale:hover {
            transform: translateY(-2px);
        }
        
        input:focus, textarea:focus, select:focus {
            outline: none;
            ring: 2px;
        }
        
        /* Scrollbar styling */
        #gradesTableBody::-webkit-scrollbar {
            width: 6px;
        }
        
        #gradesTableBody::-webkit-scrollbar-track {
            background: #f1f1f1;
        }
        
        #gradesTableBody::-webkit-scrollbar-thumb {
            background: #888;
            border-radius: 3px;
        }
        
        #gradesTableBody::-webkit-scrollbar-thumb:hover {
            background: #555;
        }
        
        /* Type badges */
        .badge-kindergarten { background-color: #fef3c7; color: #92400e; border-color: #fbbf24; }
        .badge-primary { background-color: #d1fae5; color: #065f46; border-color: #10b981; }
        .badge-middle { background-color: #dbeafe; color: #1e40af; border-color: #3b82f6; }
        .badge-high { background-color: #e9d5ff; color: #5b21b6; border-color: #8b5cf6; }
        .badge-vocational { background-color: #ffedd5; color: #9a3412; border-color: #f97316; }
        .badge-bachelor { background-color: #fee2e2; color: #991b1b; border-color: #ef4444; }
        .badge-master { background-color: #fce7f3; color: #9d174d; border-color: #ec4899; }
        .badge-doctoral { background-color: #e0e7ff; color: #3730a3; border-color: #6366f1; }
    </style>
</body>
</html>